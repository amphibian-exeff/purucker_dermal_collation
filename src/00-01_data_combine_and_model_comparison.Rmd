---
title: "Creating a Database of Amphibian Dermal Exposure Data and Assessing Model Performance"
author: Purucker ST, Snyder MN, Glinski DA, Van Meter RJ, Garber K, Cyterski MJ, Sinnathamby
  S, Henderson WM
output:
  pdf_document: default
  html_document:
    df_print: paged
---  

```{r eval=FALSE, echo=FALSE}
#ctrl-shift k to knit r markdown
#https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf
```
<br><br>

***

**Introduction**
========================================================

The purpose of this script is to combine the data sets from Van Meter et al. (2014, 2015, 2016, 2018), Glinski et al. (2018a, b, 2019, 2020), and Henson-Ramsey (2008) to create a collated database of amphibian dermal exposure data.    

| Manuscript | Data Set (Original Source Link) | Data Set (Repo Link) | Additional Data Sets |
| --------------------- |:-------------------------- |:------------------------ |:--------------------------|
| <a href= "https://www.sciencedirect.com/science/article/pii/S0269749114002899?via%3Dihub">Van Meter et al. 2014 | <a href="https://github.com/puruckertom/VanMeteretal2014_EnvPoll/tree/master/data_in">good_data.csv</a> | <a href="https://github.com/puruckertom/amphib_dermal_collation/blob/master/data_in/vm2014_data.csv">vm2014_data.csv</a> ||
| <a href="https://link.springer.com/article/10.1007%2Fs00244-015-0183-2">Van Meter et al. 2015 | <a href="https://github.com/puruckertom/VanMeteretal2015_AECT/tree/master/data">good_data.csv</a>| <a href="https://github.com/puruckertom/amphib_dermal_collation/blob/master/data_in/vm2014_data.csv">vm2014_data.csv</a> ||
| <a href="https://setac.onlinelibrary.wiley.com/doi/full/10.1002/etc.3439">Van Meter et al. 2016 | <a href="https://github.com/puruckertom/vanmeteretal2016_etc_amphibian_exposure_som/tree/master/data_in">RDATA.csv</a>|<a href="https://github.com/puruckertom/amphib_dermal_collation/blob/master/data_in/vm2016_data.csv">vm2016_data.csv</a> ||
| <a href="https://www.sciencedirect.com/science/article/pii/S004896971733601X?via%3Dihub">Van Meter et al. 2018 | <a href="https://github.com/puruckertom/amphib_dermal_collation/blob/master/data_in/vm2017_merge.csv">vm2017_merge.csv</a>|<a href="https://github.com/puruckertom/amphib_dermal_collation/blob/master/data_in/vm2017_merge.csv">vm2017_merge.csv</a> ||
| <a href="https://link.springer.com/article/10.1007%2Fs11356-018-1830-8">Glinski et al. 2018a (dehydration) | <a href="https://github.com/puruckertom/glinski_dehydration/tree/master/csv_in"> dehydration3.csv </a>| <a href="https://github.com/puruckertom/amphib_dermal_collation/blob/master/data_in/dag2016_data_dehydration.csv"> dag2016_data_dehydration.csv </a> | |
| <a href="https://www.sciencedirect.com/science/article/pii/S0378427418300626?via%3Dihub">Glinski et al. 2018b (metabolites) </a>| <a href="https://github.com/puruckertom/glinski_metabolites/tree/master/csv_in"> exposure_experiment.csv </a>| <a href="https://github.com/puruckertom/amphib_dermal_collation/blob/master/data_in/dag2016_data_metabolites_4merge.csv"> dag2016_data_metabolites_4merge.csv </a>  ||
| <a href= "http://www.publish.csiro.au/en/EN18163">Glinski et al. 2019 (biomarkers) | <a href="https://github.com/puruckertom/glinski_biomarkers/tree/master/csv_in">exposure_mixtures3.csv</a>| <a href="https://github.com/puruckertom/amphib_dermal_collation/blob/master/data_in/dag2018_data_biomarkers.csv"> dag2018_data_biomarkers.csv </a> | <a href="https://github.com/puruckertom/glinski_biomarkers/tree/master/csv_in">biomarker.csv</a> (dag_biomarker2.csv) |
| Glinski et al. 2020  (dermal routes) | <a href="https://github.com/puruckertom/glinski_dermal_routes/tree/master/inputs"> Water_soil.csv </a>|<a href="https://github.com/puruckertom/amphib_dermal_collation/blob/master/data_in/dag2019_dermal_routes.csv"> dag2019_dermal_routes.csv </a> | <a href="https://github.com/puruckertom/amphib_dermal_collation/blob/master/data_in/Dermal_routes_weights.csv">Dermal_routes_weights.csv</a> (weights) |
| <a href="https://link.springer.com/article/10.1007/s00244-007-9091-4">Henson-Ramsey 2008 |<a href="https://github.com/puruckertom/amphib_dermal_collation/blob/master/pdf/HensonRamseyetal2008_data.pdf"> HensonRamseyetal2008_data.pdf </a> | <a href="https://github.com/puruckertom/amphib_dermal_collation/blob/master/data_in/hr2008_data.csv"> hr2008_data.csv </a>||

  
<br><br>

***     
**Computational environment**
========================================================
This repository can be found at: 
https://github.com/puruckertom/amphib_dermal_collation

If you are on a Mac and get xquartz complaints (knitr), install from:
https://www.xquartz.org/


```{r eval=FALSE, echo=FALSE}
#library(installr) #windows only currently
#updateR()
```
```{r eval = TRUE, echo = FALSE, include = FALSE}
# You are using the following R Version and System
R.Version()$version.string
Sys.info()[4]
```

```{r eval = TRUE, echo = FALSE, include = FALSE}
# Install required libraries
library(ggplot2)
require(gridExtra)
library(reshape2)
library(kableExtra)
library(knitr)
library(dplyr)
library(tidyr)
library(stringr)
library(anchors)

# Update according to the System you are using...
# tom epa linux
if(Sys.info()[4] == "d2626ut7920d.rtpnc.epa.gov"){
  amphibdir <- path.expand("~/git/amphib_dermal_collation/")
}
# tom epa laptop
if(Sys.info()[4] == "LZ2626UTPURUCKE"){
  amphibdir <- path.expand("C:/git/amphib_dermal_collation/")
}
# Emma's laptop
if(Sys.info()[4]=="LZ2626UECHELSVI"){
  amphibdir <- path.expand("C:/Users/echelsvi/git/amphib_dermal_collation/")
}

# Variable names for data
amphibdir_data_in <- paste(amphibdir,'data_in/',sep='')
amphibdir_data_out <- paste(amphibdir,'data_out/',sep='')
amphibdir_graphics <- paste(amphibdir,'graphics/',sep='')
amphibdir_src <- paste(amphibdir,'src/',sep='')
```
<br><br>

***

**Data from Relevant Studies**
========================================================
### Van Meter et al. 2014 and Van Meter et al. 2015

Van Meter et al. 2014 performed exposures for 5 pesticide active ingredients (imidacloprid, pendimethalin, atrazine, fipronil, tridimefon) and 7 species (Southern leopard frog (*Lithobates sphenocephala*), Fowler's toad (*Anaxyrus fowleri*), gray treefrog (*Hyla versicolor*), Northern cricket frog (*Acris crepitans*), Eastern narrowmouth toad (*Gastrophryne carolinensis*), barking treefrog (*Hyla gratiosa*) and green treefrog (*Hyla cinerea*)). Whole body tissue concentrations were measured after an 8 hour exposure period to contaminated soil. Pesticides were applied at the maximum legally allowable application rates scaled down to the area of a 10-gallon aquarium (1225 cm^2^).

Van Meter et al. 2015 contrasted two pesticide exposure scenarios: direct exposure through aerial overspray and indirect exposure through soil.  These scenarios tested the same 5 pesticide active ingredients and two of the species (barking treefrog (*Hyla gratiosa*) and green treefrog (*Hyla cinerea*)). Pesticides were applied at the maxium legally allowable application rates scaled down to the size of a 10-gallon aquarium, with the exception of pedimethalin which was applied at 30% of the permitted application rate. This was due to pedimethalin's insolubility in the limited solvent and the water volumes used in this study.

For our purposes, the Van Meter et al. 2015 essentially adds the aerial overspray exposures to the Van Meter et al. 2014 data set. 


*Note: this file does include metabolites into the total for the parents*
```{r eval = TRUE, echo = FALSE, include = FALSE}
##################
#the data sets
##################
# import data from Van Meter 2014 and 2015 papers.
# this file does include metabolites into the totals for the parents
vm2015_file <- paste(amphibdir_data_in,"vm2014_data.csv", sep="")
file.exists(vm2015_file)
vm2015 <- read.table(vm2015_file, header = TRUE, sep = ",")
```
**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE}
dim(vm2015)
colnames(vm2015)
summary(vm2015)
```
<br>

### Van Meter et al. 2016

Van Meter et al. 2016 considered bioconcentration of 5 current-use pesticides (imidacloprid, atrazine, triadimefon, fipronil, and pedimethalin) in American toads (*Bufo americanus*) across soil types. Toads were exposed to one of two soil types with significantly different organic matter content (14.1% = high organic matter, 3.1% = low organic matter). Whole body tissue concentrations were measured after an 8 hour exposure period to contaminated soil. Pesticides were applied at the maximum legally allowable application rates scaled down to the area of six 0.94 L Pyrex glass bowls each with a 15 cm diameter.  

*Note: this file does include metabolites into the total for the parents*
```{r eval = TRUE, echo = FALSE, include = FALSE}
# import data from Van Meter 2016
#this file does include metabolites into the totals for the parents
vm2016_file <- paste(amphibdir_data_in,"vm2016_data.csv", sep="")
file.exists(vm2016_file)
vm2016 <- read.table(vm2016_file, header = TRUE, sep = ",")
```
**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE}
dim(vm2016)
colnames(vm2016)
summary(vm2016)
```
<br>

### Glinski et al. 2018a (Dehydration)

Glinski et al. 2018a studied how amphibian hydration status influences uptake of pesticides through dermal exposure. Amphibians (Southern leopard frogs (*Lithobates sphenocephala*) and Fowler's toads (*Anaxyrus fowleri*)) were dehyrated for periods of 0, 2, 4, 6, 8, or 10 hours prior to exposure to pesticide-contaminated soils. Pesticides studied included atrazine, triadimefon, metolachlor, chlorothalonil, and imidacloprid. Soil and whole-body homogenates were measured after an 8 hour exposure period. Pesticides were applied at the maximum legally allowable application rates scaled down to the area of six 0.94 L Pyrex glass bowls each with a 15 cm diameter.

*Note: this file does not combine daughters with parents*  
*Note: this file has body burdens and soil concentrations as separate rows*
```{r eval = TRUE, echo = FALSE, include = FALSE}
# import data from Glinski 2016 dehydration study
# this file does not combine daughters with parents
# this file also has body burdens and soil concentrations as separate rows
dag2016_dehy_file <- paste(amphibdir_data_in,"dag2016_data_dehydration.csv", sep="")
file.exists(dag2016_dehy_file)
dag2016_dehy0 <- read.table(dag2016_dehy_file, header = TRUE, sep = ",")
```
**Data Set Dimensions, column Names, and Summary:**
```{r eval = TRUE, echo = FALSE}
dim(dag2016_dehy0)
colnames(dag2016_dehy0)
summary(dag2016_dehy0)
```
<br>

### Henson-Ramsey 2008  

Henson-Ramsey 2008 tested the biological impact of exposure to malathion for tiger salamanders (*Ambystoma tigrinum*). Tiger salamanders were exposed to contaminated soils with 50 ug/cm^2^ or 100 ug/cm^2^ malathion and through ingestion of an earthworm exposed to contaminated soils with 200 ug/cm^2^ malathion. For each exposure, the malathion application rate was sprayed onto the approximately 1200g of soil in the 1060cm^2^ polyethylene cages. Tissue concentrations were assessed for five treatment groups: unexposed, exposed to 50 ug/cm^2^ contaminated soil for 1 day, exposed to 50 ug/cm^2^ for 2 days, exposed to 50 ug/cm^2^ contaminated soil for 2 days and fed a contaminated worm on the first exposure day, and exposed to 100 ug/cm^2^ contaminated soil for 2 days and fed a contaminated worm on the first exposure day. 

```{r eval = TRUE, echo = FALSE, include = FALSE}
# import data from Henson-Ramsey 2008
hr2008_file <- paste(amphibdir_data_in,"hr2008_data.csv", sep="")
file.exists(hr2008_file)
hr2008 <- read.table(hr2008_file, header = TRUE, sep = ",")
```
**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE}
dim(hr2008)
colnames(hr2008)
summary(hr2008)
```
<br>

### Glinski et al. 2018b (Metabolites)

Glinski et al. 2018b assessed the potential metabolic activation of pesticides (atrazine, triadimefon, fopronil) in amphibians.  This data set (1) contains *in vitro* and *in vivo* metabolic rate constants derived from toad (*Anaxyrus terrestris*) livers during experiments measuring the depletion of pesticides and the formation of their metabolites. Pesticides were applied at the maximum legally allowable application rates scaled down to the area of a 10-gallon aquarium (1225 cm^2^).

```{r eval = TRUE, echo = FALSE, include = FALSE}
# import data from Glinski 2017 metabolite study
dag2016_metabolite_file <- paste(amphibdir_data_in,"dag2016_data_metabolites.csv", sep="")
file.exists(dag2016_metabolite_file)
dag2016_metabolite0 <- read.table(dag2016_metabolite_file, header = TRUE, sep = ",")
```
#### **Metabolites Data Set (1)**
**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE}
dim(dag2016_metabolite0)
colnames(dag2016_metabolite0)
summary(dag2016_metabolite0)
```

The *in vitro* derived constants were assessed for their precitability by exposing Fowler's toads (*Anaxyrus fowleri*) to contaminated soils at maximum application rate for 2, 4, 12, and 48 hours. This data set (merged) contains the data from the Fowler's toad experiment along with the tissue concentrations from data set 1; this data set (merged) is used in subsequent steps.
```{r eval = TRUE, echo = FALSE, include = FALSE}
# import data from Glinski 2017 metabolite study
dag2016_metabolite_merge_file <- paste(amphibdir_data_in,"dag2016_data_metabolites_4merge.csv", sep="")
file.exists(dag2016_metabolite_merge_file)
dag2016_metabolite_merge <- read.table(dag2016_metabolite_merge_file, header = TRUE, sep = ",")
```
#### **Metabolites Data Set (merged)**
**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(dag2016_metabolite_merge)
colnames(dag2016_metabolite_merge)
summary(dag2016_metabolite_merge)
```
<br>

### Glinski et al. 2019 (Biomarkers)

Glinski et al. 2019 exposed Southern leopard frogs (*Lithobates sphenocephala*) to either the maximum or 1/10th maximum pesticide application rate to single, double, or triple pesticide mixtures of bifenthrin, metolachlor, and triadimefon to consider the typical co-application of pesticides during agricultural growing seasons. Tissue concentrations and metabolomic profiling of amphibian livers were studied after an 8 hour exposure period to pesticide-contaminated soil. Pesticides application rates were scaled down to the area of eight 0.94 L Pyrex glass bowls each with a 15 cm diameter. 

```{r eval = TRUE, echo = FALSE, include = FALSE}
# import data from Glinski 2018 biomarkers study
dag2018_biomarkers_file <- paste(amphibdir_data_in,"dag2018_data_biomarkers.csv", sep="")
file.exists(dag2018_biomarkers_file)
dag2018_mbiomarker0 <- read.table(dag2018_biomarkers_file, header = TRUE, sep = ",")
```
**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE}
dim(dag2018_mbiomarker0)
colnames(dag2018_mbiomarker0)
summary(dag2018_mbiomarker0)
```
<br>

### Van Meter et al. 2018 (Multiple Pesticides Study)

Van Meter et al. 2018 evaluated risks to amphibians after exposure to a single pesticide and pesticide mixtures. The five pesticides studied were three herbicides (atrazine, metolachlor, and 2,4-D), one insecticide (malathion), and one fungicide (propiconazole). Juvenile green frogs (*Lithobates clamitans*) were exposed to contaminated soils for 8 hours and metabolic analysis of amphibian livers was conducted to measure the effects. Pesticides were applied at the maximum legally allowable application rates individually and in mixtures of two or three pesticides within an herbicide or mixed pesticide group, scaled down to the area of six 0.94 L Pyrex glass bowls each with a 15 cm diameter.

Two data sets were generated from this study, one containing data for exposure to herbicides (single and mixed) and the other containing data for exposure to mixed pesticide treatments (herbicides, insecticide, fungicide).
```{r eval = TRUE, echo = FALSE, include = FALSE}
# import data from Van Meter 2017 herbs
rvm2017_herbs_file <- paste(amphibdir_data_in,"vm2017_herbs.csv", sep="")
file.exists(rvm2017_herbs_file)
rvm2017_herbs0 <- read.table(rvm2017_herbs_file, header = TRUE, sep = ",")
```
#### **Herbicide Data Set**
**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE}
dim(rvm2017_herbs0)
colnames(rvm2017_herbs0)
summary(rvm2017_herbs0)
```
```{r eval = TRUE, echo = FALSE, include = FALSE}
# import data from Van Meter 2017 hif
rvm2017_hif_file <- paste(amphibdir_data_in,"vm2017_hif.csv", sep="")
file.exists(rvm2017_hif_file)
rvm2017_hif0 <- read.table(rvm2017_hif_file, header = TRUE, sep = ",")
```
#### **Mixed Pesticide Data Set**
**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE}
dim(rvm2017_hif0)
colnames(rvm2017_hif0)
summary(rvm2017_hif0)
```


The herbicide and mixed pesticide data sets were cleaned prior and joined into a merged data set (referred to as Van Meter et al. 2018 Multiple Pesticides Study in subsequent steps). The single and mixed-pesticide treatments that were retained in the merged data set include atrazine, propiconazole, 2,4-D, malathion, and metolachlor.  Original columns from the herbicide and mixed pesticide data sets were altered for standardization. These standardized columns will be used in future data cleaning steps in order to merge all data sets. 
```{r eval = TRUE, echo = FALSE, include = FALSE}
rvm2017_merge_file <- paste(amphibdir_data_in,"vm2017_merge.csv", sep="")
file.exists(rvm2017_merge_file)
rvm2017_merge <- read.table(rvm2017_merge_file, header = TRUE, sep = ",")
```
#### **Merged Data Set**
**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE}
dim(rvm2017_merge)
colnames(rvm2017_merge)
summary(rvm2017_merge)
```
<br>

### Glinski et al. 2020 (Dermal Routes)

Glinski et al. 2020 assessed dermal uptake in amphibians from exposure to three pesticides (bifenthrin, chlorpyrifos, trifloxystrobin). Pesiticide body burdens and hepatic metabolome for Leopard frogs were measured for two routes of uptake: uptake from contaminated soils versus uptake from contaminated surface water. Pesticides were applied at 1 ppm, scaled down to the area of eight 0.94 L Pyrex glass bowls each with a 15 cm diameter.  

```{r eval = TRUE, echo = FALSE, include = FALSE}
# import data from Glinski 2019 dermal routes study
dermal_routes_file <- paste(amphibdir_data_in,"dag2019_dermal_routes.csv", sep="")
file.exists(dermal_routes_file)
dermal_routes <- read.table(dermal_routes_file, header = TRUE, sep = ",")
```
**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE}
dim(dermal_routes)
names(dermal_routes)
summary(dermal_routes)
```
<br><br>

***
**Application Rates**
=============================================================
The table below concisely displays the pesticide applications rates (ug/cm^2^) used in each relevant study as well as the variables used to compute the application rates.

```{r eval = TRUE, include = FALSE}
app_rates_file <- paste0(amphibdir_data_in, "app_rates.txt")
file.exists(app_rates_file)
app_rates <- read.table(app_rates_file, header = TRUE, sep = ",")
```

```{r eval = TRUE, echo = FALSE, include = TRUE}
kable(app_rates[, 2:9]) %>%
  kable_styling("striped", full_width = F) %>%
  pack_rows("Van Meter et al. 2014/2015", 1, 5) %>%
  pack_rows("Van Meter et al. 2016", 6, 10) %>%
  pack_rows("Van Meter et al. 2018", 11, 15) %>%
  pack_rows("Henson-Ramsey et al. 2008", 16, 16) %>%
  pack_rows("Glinski et al. 2018a", 17, 21) %>%
  pack_rows("Glinski et al. 2018b", 22, 24) %>%
  pack_rows("Glinski et al. 2019", 25, 30) %>%
  pack_rows("Glinski et al. 2020", 31, 33)  
```
<br><br>
 
***  

**Cleaning and Merging the Data Sets**
=============================================================
Each data set was cleaned for merging. This consisted of dropping unneeded columns and standardizing column names of retained columns.  Four columns were added to all data sets (soil type, formulation, exposure duration, and research study source).  
Once each data set was cleaned, a local copy was saved and the data set was merged with the previously cleaned data sets.

The process of cleaning and merging each data set is briefly described below.

<br>

*** 

### Van Meter et al. 2014/2015


```{r eval = TRUE, echo = FALSE, include = FALSE}
##################
# van meter 2014/15
##################
unique(vm2015$Chemical)
```
Metabolites and parents that do not include metabolites were dropped from the data set. This includes atrazine, deisopropyl atrazine, desethyl atrazine, fipronil, fipronil-sulfone, triadimefon, triadimenol.
```{r eval = TRUE, echo = TRUE, include = TRUE}
# drop metabolites and parents that do not include metabolites
vm2015_chem_drop <- c("Atrazine","Deisopropyl Atrazine","Desethyl Atrazine","Fipronil","Fipronil-Sulfone","Triadimefon","Triadimenol")
chem_vector_drop <- which(vm2015$Chemical %in% vm2015_chem_drop)
vm2015_subset1 <- vm2015[-chem_vector_drop,]
vm2015_subset2 <- droplevels(vm2015_subset1)
```

There were 278 observations with these chemicals.  After dropping the 278 observations from the initial 474, the updated dimensions are:
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(vm2015_subset2)
```

There were 15 unneeded columns dropped and 4 added for standarization.
```{r eval = TRUE, echo = TRUE, include = TRUE}
# drop unneeded columns for merging
all_cols <- colnames(vm2015_subset2)
drop_cols <- c("Instrument", "good", "logKow", "BCF", "initialweight", 
            "Solat20C_mgL", "Solat20C_gL", "molmass_gmol", "Density_gcm3","AppFactor", "SA_cm2", "VapPrs_mPa",
            "Koc_gmL", "HalfLife_day", "HabFac")
vm2015_subset3 <- vm2015_subset2[,!(names(vm2015_subset2) %in% drop_cols)]
colnames(vm2015_subset3)
# add columns
soil_type <- c(rep("PLE",nrow(vm2015_subset3)))
formulation <- (rep(0,nrow(vm2015_subset3)))
exp_duration<- (rep(8,nrow(vm2015_subset3)))
source <- c(rep("rvm2015",nrow(vm2015_subset3)))
vm2015_subset4 <- cbind(vm2015_subset3, formulation, soil_type, exp_duration, source)
# standardize column names
colnames(vm2015_subset4)
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="Sample")]<-"sample_id"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="Species")]<-"species"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="Chemical")]<-"chemical"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="Application")]<-"application"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="TissueConc")]<-"tissue_conc_ugg"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="SoilConc")]<-"soil_conc_ugg"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="bodyweight")]<-"body_weight_g"
colnames(vm2015_subset4)
# reorder vm2015 alphabetically
vm2015_merge <- vm2015_subset4[,order(names(vm2015_subset4))]

# write a local copy
vm2015_merge_filename <- paste(amphibdir_data_out,"vm2015_merge.csv", sep="")
write.csv(vm2015_merge, file=vm2015_merge_filename)
```
**The data set's dimensions are:**
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(vm2015_merge)
```
<br>

### Van Meter et al. 2016

```{r eval = TRUE, echo = FALSE, include = FALSE}
##################
# van meter 2016
##################
# Reformat vm2016 for merge with vm2015
dim(vm2016)
colnames(vm2016)
```

From the initial 11 columns, 4 columns were dropped and consolidated into 1, and 4 columns were added.
```{r eval = TRUE, echo = TRUE, include = TRUE}
# add sample_id
vm2016$sample_id <- paste(vm2016$Day, vm2016$Row, vm2016$Column, sep="_")
vm2016_subset2 <- subset(vm2016, select=c(-Day,-Row, -Column, -Total))
# add additional columns
species <- c(rep("American toad",nrow(vm2016_subset2)))
application <- c(rep("Indirect",nrow(vm2016_subset2)))
exp_duration<- (rep(8,nrow(vm2016_subset2)))
source <- c(rep("rvm2016",nrow(vm2016_subset2)))
vm2016_subset3 <- cbind(vm2016_subset2, species, application, exp_duration, source)
```
Application rates for several pesticides were inserted. There were 108 observations with decay products that were not sprayed; these observations were dropped so as to only include the parents in the cleaned data set. There were 60 observations with atrazine, fipronil, or triadimefon that were dropped because they do not include metabolites in total.
```{r eval = TRUE, echo = TRUE, include = TRUE}
# assign values to application rate
#unique(vm2016_subset3$Pesticide)
vm2016_subset3$app_rate_g_cm2[vm2016_subset3$Pesticide=="ATZTOT"] <- 22.9e-6
vm2016_subset3$app_rate_g_cm2[vm2016_subset3$Pesticide=="Imid"] <- 5.7e-6
vm2016_subset3$app_rate_g_cm2[vm2016_subset3$Pesticide=="FipTOT"] <- 1.1e-6
vm2016_subset3$app_rate_g_cm2[vm2016_subset3$Pesticide=="TNDTOT"] <- 2.7e-6
vm2016_subset3$app_rate_g_cm2[vm2016_subset3$Pesticide=="Pendi"] <- 69.8e-6
# drop decay products that were not sprayed, keeping only parents
rows_to_drop <- which(vm2016_subset3$Parent == 0)
vm2016_subset4 <- vm2016_subset3[-rows_to_drop,]
# drop ATZ, Fip, TDN since do not include metabolites in total
chems_to_drop <- c("ATZ","Fip","TDN")
vm2016_subset5 <- vm2016_subset4[!(vm2016_subset4$Pesticide %in% chems_to_drop),]
# drop parent field
drop_cols <- c("Parent")
vm2016_subset6 <- vm2016_subset5[,!(names(vm2016_subset5) %in% drop_cols)]
```

Several column names were standardized and all columns were ordered for ease of merging with the combined data set.  
```{r eval = TRUE, echo = TRUE, include = TRUE}
# standardize column names
colnames(vm2016_subset6)
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="Pesticide")]<-"chemical"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="SoilType")]<-"soil_type"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="BodyBurden")]<-"tissue_conc_ugg"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="Soil")]<-"soil_conc_ugg"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="Weight")]<-"body_weight_g"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="Formulation")]<-"formulation"

# alter chemical name
vm2016_subset6$chemical <- as.character(vm2016_subset6$chemical)
vm2016_subset6$chemical[vm2016_subset6$chemical=="Imid"] <- "imidacloprid"

# reorder columns alphabetically to help with merge
colnames(vm2016_subset6)
vm2016_merge <- vm2016_subset6[,order(names(vm2016_subset6))]
colnames(vm2016_merge)

# write a local copy
vm2016_merge_filename <- paste(amphibdir_data_out,"vm2016_merge.csv", sep="")
write.csv(vm2016_merge, file=vm2016_merge_filename)
```

The updated dimensions are:
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(vm2016_merge)
``` 


The Van Meter et al. 2014/2015 and Van Meter et al. 2016 data sets were combined.  

```{r eval = TRUE, echo = FALSE, include = FALSE}
colnames(vm2015_merge) 
colnames(vm2016_merge)
dim(vm2015_merge)
dim(vm2016_merge)
# combine two dataframes
combined_data0 <- rbind(vm2015_merge, vm2016_merge)
dim(combined_data0)
colnames(combined_data0)
#View(combined_data0)
combined_data_filename0 <- paste(amphibdir_data_out,"combined_data0.csv", sep="")
write.csv(combined_data0, file=combined_data_filename0)
```
**The combined data set's updated dimensions are:**
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(combined_data0)
```
<br>

### Glinski et al. 2018a (Dehydration)

```{r eval=TRUE, echo=FALSE, include = FALSE}
##################
# glinski et al 2018a dehydration
##################
# Revise dag2016_dehy to merge with van meter data sets
dim(dag2016_dehy0)
colnames(dag2016_dehy0)
#from
#[1] "time"    "parent"  "analyte" "matrix"  "species" "conc"    "ID"      "weight"

#to
# [1] "chemical"        "soil_type"       "tissue_conc_ugg" "soil_conc_ugg"   "body_weight_g"  
# [6] "formulation"     "species"         "application"     "exp_duration"    "app_rate_g_cm2"
```

The metabolite products were dropped from the data set; 600 rows from the initial 1494 rows were retained.
```{r eval = TRUE, echo = TRUE, include = TRUE}
# drop metabolite products
parent_keepers <- which(as.vector(dag2016_dehy0$parent) == as.vector(dag2016_dehy0$analyte))
dag2016_dehy1 <- dag2016_dehy0[parent_keepers,]
```

Several column names were altered for standarization across the data set, and 7 columns were added for standarization.
```{r eval = TRUE, echo = TRUE, include = TRUE}
## time is length of dehydration
#colnames(dag2016_dehy1)[which(colnames(dag2016_dehy1)=="time")]<-"exp_duration"

# standardize column names
colnames(dag2016_dehy1)[which(colnames(dag2016_dehy1)=="analyte")]<-"chemical"
colnames(dag2016_dehy1)[which(colnames(dag2016_dehy1)=="conc")]<-"tissue_conc_ugg"
colnames(dag2016_dehy1)[which(colnames(dag2016_dehy1)=="ID")]<-"sample_id"
colnames(dag2016_dehy1)[which(colnames(dag2016_dehy1)=="weight")]<-"body_weight_g"

# add additional columns
exp_duration <- c(rep(8,nrow(dag2016_dehy1)))
soil_type <- c(rep("PLE",nrow(dag2016_dehy1)))
application <- c(rep("Indirect",nrow(dag2016_dehy1)))
formulation <- (rep(0,nrow(dag2016_dehy1)))
app_rate_g_cm2 <- (rep(0,nrow(dag2016_dehy1)))
soil_conc_ugg <- (rep(0,nrow(dag2016_dehy1)))
source <- c(rep("dag_dehydration",nrow(dag2016_dehy1)))
dag2016_dehy2 <- cbind(dag2016_dehy1, formulation, soil_type, application, 
                       app_rate_g_cm2, exp_duration, soil_conc_ugg, source)
```

The updated dimensions are:
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(dag2016_dehy2)
```


```{r eval = TRUE, echo = FALSE, include = FALSE}
#reshape- cast takes long-format data and casts it into wide-format data
# matrix used to split to soil and amphibian conc columns and delete
# conc split to soil and amphibian conc columns
#make wide with soil and amphib concentrations

colnames(dag2016_dehy2)

#multiple soil concentration observations per id
#dag2016_dehy_mergefail <- dcast(dag2016_dehy3, 
#                       tissue_conc_ugg + sample_id + species + chemical + exp_duration ~ matrix, 
#                       value.var = c("tissue_conc_ugg"))
#View(dag2016_mergefail)
```

Multiple soil concentration observations were given the same ID. Until a many-to-one merge of soil concentrations could be executed, 300 rows were temporarily dropped.  There were also 3 columns dropped.
```{r eval = TRUE, echo = TRUE, include = TRUE}
# drop the soil until we can do a many-to-one merge of soil concentrations
# drop decay products that were not sprayed, keeping only parents
rows_to_drop <- which(dag2016_dehy2$matrix == 'soil')
dag2016_dehy3 <- dag2016_dehy2[-rows_to_drop,]
# parent, time and matrix columns delete
drop_cols <- c("parent","time","matrix")
dag2016_dehy4 <- dag2016_dehy3[,!(names(dag2016_dehy3) %in% drop_cols)]
```
The updated dimensions are:
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(dag2016_dehy4)
```

The application rate values were inserted, the temporarily dropped soil concentrations were updated to the current data set, and the species names were standardized.
```{r eval = TRUE, echo = TRUE, include = TRUE}
# fill in application rates
#unique(dag2016_dehy4$chemical)
update_atrazine <- which(dag2016_dehy4$chemical == 'atrazine')
dag2016_dehy4$app_rate_g_cm2[update_atrazine] <- 0.00002395 # atrazine g/cm2
update_chloro <- which(dag2016_dehy4$chemical == 'chloro+d')
dag2016_dehy4$app_rate_g_cm2[update_chloro] <-  0.0000443 # chloro g/cm2
update_metol <- which(dag2016_dehy4$chemical == 'metol')
dag2016_dehy4$app_rate_g_cm2[update_metol] <-  0.00003101 # metol g/cm2
update_tdn <- which(dag2016_dehy4$chemical == 'tdn')
dag2016_dehy4$app_rate_g_cm2[update_tdn] <- 0.00000291 # tdn g/cm2
update_imid <- which(dag2016_dehy4$chemical == 'imid')
dag2016_dehy4$app_rate_g_cm2[update_imid] <- 0.00000539 # imid g/cm2

# add back in soil concentrations (in already-made soil_conc_ugg column)
dag2016_soil <- dag2016_dehy2[rows_to_drop,]
dag2016_dehy4$soil_conc_ugg <- dag2016_soil$tissue_conc_ugg

# rename species names, according to standardized names
dag2016_dehy4$species <- as.character(dag2016_dehy4$species)
dag2016_dehy4$species[dag2016_dehy4$species == "LF"] <- "Leopard frog"
dag2016_dehy4$species[dag2016_dehy4$species == "BA"] <- "Fowlers toad"
dag2016_dehy4$species <- as.factor(dag2016_dehy4$species)
```

```{r eval = TRUE, echo = FALSE, include = FALSE}
# check soil concentrations
colnames(dag2016_soil)
dag2016_soil$tissue_conc_ugg

#View(cbind(as.vector(dag2016_dehy4$sample_id),as.vector(dag2016_dehy4$sample_id)))
#View(cbind(dag2016_dehy4$tissue_conc_ugg,dag2016_dehy4$soil_conc_ugg))
bcf <- dag2016_dehy4$tissue_conc_ugg/dag2016_dehy4$soil_conc_ugg
min(bcf)
max(bcf)
```

```{r eval = TRUE, echo = FALSE, include = FALSE}
# reorder columns alphabetically to help with merge
colnames(dag2016_dehy4)
dag2016_dehy_merge <- dag2016_dehy4[,order(names(dag2016_dehy4))]
dim(dag2016_dehy_merge)
colnames(dag2016_dehy_merge)

# write a local copy
dag2016_dehy_merge_filename <- paste(amphibdir_data_out,"dag2016_dehy_merge.csv", sep="")
write.csv(dag2016_dehy_merge, dag2016_dehy_merge_filename)

```
The dimensions are:
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(dag2016_dehy_merge)
```


The Glinkski et al. 2018a (Dehydration) was combined with the previously merged data sets.
```{r eval = TRUE, echo = FALSE, include = FALSE}
colnames(combined_data0)
colnames(dag2016_dehy_merge)
dim(combined_data0)
dim(dag2016_dehy_merge)
# combine two dataframes
combined_data1 <- rbind(combined_data0, dag2016_dehy_merge)
dim(combined_data1)
colnames(combined_data1)
rownames(combined_data1) <- seq(length=nrow(combined_data1))

combined_data_filename1 <- paste(amphibdir_data_out,"combined_data1.csv", sep="")
write.csv(combined_data1, file=combined_data_filename1)
```
**The combined data set's updated dimensions are:**
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(combined_data1)
```
<br>

### Henson-Ramsey 2008

The Henson-Ramsey 2008 data set did not require any additional data cleaning. It was combined with the previously merged data sets.
```{r eval = TRUE, echo = FALSE, include = FALSE}
colnames(combined_data1)
colnames(hr2008)
dim(combined_data1)
dim(hr2008)
# combine two dataframes
combined_data2 <- rbind(combined_data1, hr2008)
dim(combined_data2)
colnames(combined_data2)
rownames(combined_data2) <- seq(length=nrow(combined_data2))
colnames(combined_data2)

combined_data_filename2 <- paste(amphibdir_data_out,"combined_data2.csv", sep="")
write.csv(combined_data2, file=combined_data_filename2)
```
**The combined data set's updated dimensions are:**
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(combined_data2)
```
<br>

### Glinski et al. 2018b (Metabolites)

```{r eval = TRUE, echo = FALSE, include = FALSE}
##################
# glinski et al 2018b metabolites
##################
dim(dag2016_metabolite_merge)
colnames(dag2016_metabolite_merge)
```
Apart from standardizing the species name, the Glinski et al. 2018b (Metabolites) data set did not require any additional data cleaning. It was combined with the previously merged data sets.
```{r eval = TRUE, echo = TRUE, include = TRUE}
# rename species names, according to standardized names
dag2016_metabolite_merge$species <- as.character(dag2016_metabolite_merge$species)
dag2016_metabolite_merge$species[dag2016_metabolite_merge$species == "Anaxyrus_fowleri"] <- "Fowlers toad"
dag2016_metabolite_merge$species <- as.factor(dag2016_metabolite_merge$species)

```
```{r eval = TRUE, echo = FALSE, include = FALSE}
# combine two dataframes
combined_data3 <- rbind(combined_data2, dag2016_metabolite_merge)
dim(combined_data3)
colnames(combined_data3)
rownames(combined_data3) <- seq(length=nrow(combined_data3))
colnames(combined_data3)

combined_data_filename3 <- paste(amphibdir_data_out,"combined_data3.csv", sep="")
write.csv(combined_data3, file=combined_data_filename3)
```
**The combined data set's updated dimensions are:**
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(combined_data3)
```
<br>

### Glinski et al. 2019 (Biomarkers)
```{r eval = TRUE, echo = FALSE, include = FALSE}
##################
# glinski et al 2019 biomarkers
##################
# import data
dag_biomarkers_file <- paste(amphibdir_data_in,"dag2018_data_biomarkers.csv", sep="")
file.exists(dag_biomarkers_file)
dag_biomarker <- read.table(dag_biomarkers_file, header = TRUE, sep = ",")

# look at data
dim(dag_biomarker)
names(dag_biomarker)
summary(dag_biomarker)
```

Five columns were dropped from the original biomarkers data set and the names of two columns were standardized.   
```{r eval = TRUE, echo = TRUE, include = TRUE}
# drop columns
drop_cols <- c("met", "tdt", "bif", "rate", "group")
dag_biomarker_subset <- dag_biomarker[, !(names(dag_biomarker) %in% drop_cols)]

# standardize column names
colnames(dag_biomarker_subset)[which(colnames(dag_biomarker_subset)=="conc")]<-"tissue_conc_ugg"
colnames(dag_biomarker_subset)[which(colnames(dag_biomarker_subset)=="frog.weight")]<-"body_weight_g"
```
The updated column names and dimensions are:
```{r eval = TRUE, echo = FALSE, include = TRUE}
names(dag_biomarker_subset)
dim(dag_biomarker_subset)   
```

The application rates and soil concentrations were not included in the original biomarkers data set. Both are included in the following data set:

**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE, include = FALSE}
## import data (contains soil concentrations and application rates)
dag_biomarkers_file2 <- paste(amphibdir_data_in,"dag2018_data_biomarkers_2.csv", sep="")
file.exists(dag_biomarkers_file2)
dag_biomarker2 <- read.table(dag_biomarkers_file2, header = TRUE, sep = ",")
```
```{r eval = TRUE, echo = FALSE, include = TRUE}
## look at data
dim(dag_biomarker2)
names(dag_biomarker2)
summary(dag_biomarker2)
```
The application rates were converted from mg to g/cm^2^.
```{r eval = TRUE, echo = TRUE, include = TRUE}
dag_biomarker2_update <- replace.value(dag_biomarker2, "app.rate.met", from=55.106, to=3.062e-5, verbose=TRUE)
dag_biomarker2_update <- replace.value(dag_biomarker2_update, "app.rate.met", from=5.5106, to=3.062e-6, verbose=FALSE)
dag_biomarker2_update <- replace.value(dag_biomarker2_update, "app.rate.tdn", from=5.173, to=2.87e-6, verbose=FALSE)
dag_biomarker2_update <- replace.value(dag_biomarker2_update, "app.rate.tdn", from=.5173, to=2.87e-7, verbose=FALSE)
dag_biomarker2_update <- replace.value(dag_biomarker2_update, "app.rate.bif", from=6.209, to=3.45e-6, verbose=FALSE)
dag_biomarker2_update <- replace.value(dag_biomarker2_update, "app.rate.bif", from=.6209, to=3.45e-7, verbose=FALSE)

```

A one-to-one merge was conducted based on the unique sample id for each measured pesticide (either bifenthrin, metolachlor, or triadimefon) to join the original biomarkers data set and the data set containing the application rates and soil concentrations. Vectors containing the application rates and soil concentrations were joined to the original data set. 
```{r eval = TRUE, echo = TRUE, include = TRUE}
# bif extraction
dag_biomarker_subset_bif <- dag_biomarker_subset[dag_biomarker_subset$pesticide == "bif", ]
dag_biomarker2_subset_bif <- dag_biomarker2_update[dag_biomarker2_update$BIF != 0, ]

dag_biomarker_bif_merge <- merge(x = dag_biomarker_subset_bif, y = dag_biomarker2_subset_bif,
                                by.x = "sample_id", by.y = "SAMPLE", all.x = TRUE)

# met extraction
dag_biomarker_subset_met <- dag_biomarker_subset[dag_biomarker_subset$pesticide == "met", ]
dag_biomarker2_subset_met <- dag_biomarker2_update[dag_biomarker2_update$Met != 0, ]

dag_biomarker_met_merge <- merge(x = dag_biomarker_subset_met, y = dag_biomarker2_subset_met,
                                 by.x = "sample_id", by.y = "SAMPLE", all.x = TRUE)

# tdt extraction
dag_biomarker_subset_tdt <- dag_biomarker_subset[dag_biomarker_subset$pesticide == "tdt", ]
dag_biomarker2_subset_tdt <- dag_biomarker2_update[dag_biomarker2_update$TDN != 0, ]

dag_biomarker_tdt_merge <- merge(x = dag_biomarker_subset_tdt, y = dag_biomarker2_subset_tdt,
                                 by.x = "sample_id", by.y = "SAMPLE", all.x = TRUE)


# combine bif, met, and tdt
app_bind_bmt <- c(dag_biomarker_bif_merge[,"app.rate.bif"], 
                  dag_biomarker_met_merge[,"app.rate.met"], dag_biomarker_tdt_merge[,"app.rate.tdn"])

soil_bind_bmt <- c(dag_biomarker_bif_merge[,"BIF.soil"], 
                   dag_biomarker_met_merge[,"Met.soil"], dag_biomarker_tdt_merge[,"TDN.soil"]) 


# join app and soil vectors to data set
dag_biomarker_subset2 <- dag_biomarker_subset[order(dag_biomarker_subset[, 3]),]
rownames(dag_biomarker_subset2) <- seq(length=nrow(dag_biomarker_subset2))

dag_biomarker_subset3 <- cbind(dag_biomarker_subset2, app_bind_bmt, soil_bind_bmt)

# standardize column names
colnames(dag_biomarker_subset3)[which(colnames(dag_biomarker_subset3)=="app_bind_bmt")]<-"app_rate_g_cm2"
colnames(dag_biomarker_subset3)[which(colnames(dag_biomarker_subset3)=="soil_bind_bmt")]<-"soil_conc_ugg"
```
The updated column names and dimensions are:
```{r eval = TRUE, echo = FALSE, include = TRUE}
# look at data
names(dag_biomarker_subset3)
dim(dag_biomarker_subset3)
```

New columns were created for standarization, the columns were ordered alphabetically, and a local copy was stored. 
```{r eval = TRUE, echo = TRUE, include = TRUE}
# create new columns
application <- c(rep("soil", nrow(dag_biomarker_subset3)))
exp_duration <- c(rep(8, nrow(dag_biomarker_subset3)))
formulation <- c(rep(0, nrow(dag_biomarker_subset3)))
soil_type <- c(rep(NA, nrow(dag_biomarker_subset3)))
source <- c(rep("dag_biomarker", nrow(dag_biomarker_subset3)))
species <- c(rep("Leopard frog", nrow(dag_biomarker_subset3)))

# combine columns   
dag_biomarker_subset4 <- cbind(dag_biomarker_subset3, application, exp_duration, 
                               formulation, soil_type, source, species)

# standardize pesticide column
dag_biomarker_subset4$pesticide <- as.character(dag_biomarker_subset4$pesticide)
dag_biomarker_subset4$pesticide[dag_biomarker_subset4$pesticide == "bif"] <- "Bifenthrin"
dag_biomarker_subset4$pesticide[dag_biomarker_subset4$pesticide == "met"] <- "Metolachlor"
dag_biomarker_subset4$pesticide[dag_biomarker_subset4$pesticide == "tdt"] <- "Triadimefon"

colnames(dag_biomarker_subset4)[which(colnames(dag_biomarker_subset4)=="pesticide")]<-"chemical"

# unite function for sample id and chemical
dag_biomarker_subset5 <- unite(data = dag_biomarker_subset4, col = "sample_id", "sample_id", "chemical", sep = " ", remove = FALSE)

# order columns in abc for merge
dag_biomarker_merge <- dag_biomarker_subset5[ ,order(names(dag_biomarker_subset5))]
```
```{r eval = TRUE, echo = FALSE, include = FALSE}
# write a local copy
dag_biomarker_merge_filename <- paste(amphibdir_data_out,"dag_biomarker_merge.csv", sep="")
write.csv(dag_biomarker_merge, file = dag_biomarker_merge_filename)
```
The updated column names and dimensions are:
```{r eval = TRUE, echo = FALSE, include = TRUE}
names(dag_biomarker_merge)
dim(dag_biomarker_merge)
```

The Glinski et al. 2019 (Biomarkers) was combined with the previously merged data sets.    
```{r eval = TRUE, echo = FALSE, include = FALSE}
# combine data frames
combined_data4 <- rbind(combined_data3, dag_biomarker_merge)
dim(combined_data4)
colnames(combined_data4)
rownames(combined_data4) <- seq(length=nrow(combined_data4))
colnames(combined_data4)

combined_data_filename4 <- paste(amphibdir_data_out,"combined_data4.csv", sep="")
write.csv(combined_data4, file=combined_data_filename4)
```
**The combined data set's updated dimensions are:**
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(combined_data4)
```
<br>

### Van Meter et al. 2018 (Multiple Pesticides Study)

The Van Meter et al. 2018 (Multiple Pesticides Study) data set did not require any additional data cleaning. It was combined with the previously merged data sets.
```{r eval = TRUE, echo = FALSE, include = FALSE}
##################
# van meter et al 2017 multi-pesticide study merge
##################
dim(rvm2017_merge)
colnames(rvm2017_merge)

# combine two dataframes
combined_data5 <- rbind(combined_data4, rvm2017_merge)
dim(combined_data5)
colnames(combined_data5)
rownames(combined_data5) <- seq(length=nrow(combined_data5))
colnames(combined_data5)

combined_data_filename5 <- paste(amphibdir_data_out,"combined_data5.csv", sep="")
write.csv(combined_data5, file=combined_data_filename5)
```
**The combined data set's updated dimensions are:**
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(combined_data5)
```
<br>

### Glinski et al. 2020 (Dermal Routes)

The dermal routes data set did not include the body weights for the measured amphibians. These weights were included in a separate data set:
```{r eval = TRUE, echo = FALSE, include = FALSE}
#import dermal routes data, with amphibians weights
weights_file <- paste(amphibdir_data_in, "Dermal_routes_weights.csv", sep = "")
file.exists(weights_file)
weights <- read.table(weights_file, header = TRUE, sep = ",")
```
**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(weights)
names(weights)
summary(weights)
```

A one-to-many merge was employed to merge the dermal routes data set and the weights data set based on the Sample ID. Only rows where the Matrix is "Amphibian" have a body weight; all other rows are NA. 
```{r eval = TRUE, echo = TRUE, include = TRUE}
# merge (one-to-many) dermal routes data with weights data, based on Sample ID
dermal_routes_subset2 <- dermal_routes[order(dermal_routes$Sample.ID), ]
weights_2 <- weights[order(weights$Sample),]

dermal_routes_subset3 <- merge(dermal_routes_subset2, weights_2, 
                               by.x = "Sample.ID", by.y = "Sample", all.x = TRUE, all.y = TRUE)
```
The updated dimensions are:
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(dermal_routes_subset3)
```
The soil concentrations, where the Media and Matrix are both "Soil," was subset from the data set to be used later in the data cleaning process. These soil concentrations (currently listed in the "Concentration" column) will be used for the soil_conc_ugg column in the cleaned data set.
```{r eval = TRUE, echo = TRUE, include = TRUE}
# subset soil to be used later for soil concentration column (will use "Concentration" column)
soil_subset <- dermal_routes_subset2[dermal_routes_subset2$Media == "Soil", ]
soil_subset2 <- soil_subset[soil_subset$Matrix == "Soil",]
```
The dimensions of this soil subset are:
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(soil_subset2)
```

Referring back to the main dermal routes data set: we are only interested in the pesticide exposures on amphibians while in soil. These rows were subset.
```{r eval = TRUE, echo = TRUE, include = TRUE}
# want Media == soil because interested in dermal exposure in soil
dermal_routes_subset4 <- dermal_routes_subset3[dermal_routes_subset3$Media == "Soil",]
#sum(dermal_routes_subset3$Media == "Soil") # == 96
#dim(dermal_routes_subset4) # == 96 x 6

# want Matrix == Amphibian because interested in amphib exposure
dermal_routes_subset5 <- dermal_routes_subset4[dermal_routes_subset4$Matrix == "Amphibian", ]
#sum(dermal_routes_subset4$Matrix == "Amphibian") # == 48
#dim(dermal_routes_subset5) # == 48 x 6
```
The updated dimensions are:
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(dermal_routes_subset5)
```

The soil concentrations were appended to the main dermal routes data set.
```{r eval = TRUE, echo = TRUE, include = TRUE}
# add in soil concentration column, previously subset
# order by Sample.ID, then by Analyte name to match up rows for the two data sets
dermal_routes_subset6 <- dermal_routes_subset5[order(dermal_routes_subset5[,1], 
                                                     dermal_routes_subset5[,2]),]
soil_subset3 <- soil_subset2[order(soil_subset2[,1], soil_subset2[,2]),]

#dim(dermal_routes_subset6) # == 48 x 6
#dim(soil_subset3) # == 48 x 5

dermal_routes_subset7 <- cbind(dermal_routes_subset6, soil_subset3$Concentration)
```
The updated dimensions are:
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(dermal_routes_subset7)
```

The metabolites were dropped from the data set.  Additionally, several new columns were created for standarization, existing columns were standardized according to the naming conventions of the collated data set, and unneeded columns were dropped.  Columns were ordered alphabetically for ease of merging.
```{r eval = TRUE, echo = TRUE, include = TRUE}
# drop metabolites
rows_to_drop <- c("4-OH", "CPO", "TFSa")
dermal_routes_subset8 <- dermal_routes_subset7[!(dermal_routes_subset7$Analyte %in% rows_to_drop),]

# create new columns
app_rate_g_cm2 <- c(rep(NA, nrow(dermal_routes_subset8)))
application <- c(rep("soil", nrow(dermal_routes_subset8)))
exp_duration <- c(rep(8, nrow(dermal_routes_subset8)))
formulation <- c(rep(0, nrow(dermal_routes_subset8)))
soil_type <- c(rep("OLS", nrow(dermal_routes_subset8)))
source <- c(rep("dag_dermal_routes", nrow(dermal_routes_subset8)))
species <- c(rep("Leopard frog", nrow(dermal_routes_subset8)))

# alter existing column names
colnames(dermal_routes_subset8)

colnames(dermal_routes_subset8)[which(colnames(dermal_routes_subset8)=="Analyte")]<-"chemical"
colnames(dermal_routes_subset8)[which(colnames(dermal_routes_subset8)=="Sample.ID")]<-"sample_id"
colnames(dermal_routes_subset8)[which(colnames(dermal_routes_subset8)=="Concentration")]<-"tissue_conc_ugg"
colnames(dermal_routes_subset8)[which(colnames(dermal_routes_subset8)=="soil_subset3$Concentration")]<-"soil_conc_ugg"
colnames(dermal_routes_subset8)[which(colnames(dermal_routes_subset8)=="Weight_g")]<-"body_weight_g"


# combine columns
dermal_routes_subset9 <- cbind(dermal_routes_subset8, app_rate_g_cm2, application, exp_duration, 
                               formulation, soil_type, source, species)
names(dermal_routes_subset9)

# drop columns
cols_to_drop <- c("Matrix", "Media")
dermal_routes_subset10 <- dermal_routes_subset9[, !(names(dermal_routes_subset9) %in% cols_to_drop)]

# insert application rates
dermal_routes_subset10$chemical <- as.character(dermal_routes_subset10$chemical)
unique(dermal_routes_subset10$chemical)
dermal_routes_subset10$app_rate_g_cm2[dermal_routes_subset10$chemical =="BIF"] <- 2.8889e-7 #bifenthrin g/cm2
dermal_routes_subset10$app_rate_g_cm2[dermal_routes_subset10$chemical =="CPF"] <- 3.1111e-7 #chlorpyrifos g/cm2
dermal_routes_subset10$app_rate_g_cm2[dermal_routes_subset10$chemical =="TFS"] <- 3.0222e-7 #trifloxystrobin g/cm2

summary(dermal_routes_subset10$app_rate_g_cm2)


# order columns in abc for merge
dermal_routes_merge <- dermal_routes_subset10[ ,order(names(dermal_routes_subset10))]
```

The updated column names and dimensions are:
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(dermal_routes_merge)
names(dermal_routes_merge)
```

A local copy was saved, and the data set was combined with the collated data set.
```{r eval = TRUE, echo = FALSE, include = FALSE}
# write a local copy
dag2019_merge_filename <- paste(amphibdir_data_out,"dag2019_merge.csv", sep="")
write.csv(dermal_routes_merge, file = dag2019_merge_filename)

# combine two dataframes
combined_data6 <- rbind(combined_data5, dermal_routes_merge)
dim(combined_data6)
colnames(combined_data6)
rownames(combined_data6) <- seq(length=nrow(combined_data6))
colnames(combined_data6)

combined_data_filename6 <- paste(amphibdir_data_out,"combined_data6.csv", sep="")
write.csv(combined_data6, file=combined_data_filename6)
```
**The combined data set's updated dimensions are:**
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(combined_data6)
```
<br><br>

***

**Final Product**
=============================================================
Minor alterations were made to the final collated data set to standardize names of the application types and chemicals.
```{r eval = TRUE, echo = TRUE, include = TRUE}
amphib_dermal_collated <- combined_data6

colnames(amphib_dermal_collated)

# check to see if everything ok
summary(amphib_dermal_collated$app_rate_g_cm2) 
summary(amphib_dermal_collated$body_weight_g) 
summary(amphib_dermal_collated$exp_duration)
summary(amphib_dermal_collated$soil_conc_ugg) # 206 NAs
summary(amphib_dermal_collated$tissue_conc_ugg)

# standardize application levels
amphib_dermal_collated$application <- tolower(amphib_dermal_collated$application)
amphib_dermal_collated$application <- as.factor(amphib_dermal_collated$application)

# standardize chemical levels
amphib_dermal_collated$chemical <- as.character(amphib_dermal_collated$chemical)

amphib_dermal_collated$chemical[amphib_dermal_collated$chemical == "fip"] <- "fipronil"
amphib_dermal_collated$chemical[amphib_dermal_collated$chemical == "BIF"] <- "bifenthrin"
amphib_dermal_collated$chemical[amphib_dermal_collated$chemical == "MET"] <- "metolachlor"
amphib_dermal_collated$chemical[amphib_dermal_collated$chemical == "MAT"] <- "malathion"
amphib_dermal_collated$chemical[amphib_dermal_collated$chemical == "ATZT"] <- "atrazine"
amphib_dermal_collated$chemical[amphib_dermal_collated$chemical == "PROPT"] <- "propiconazole"
amphib_dermal_collated$chemical[amphib_dermal_collated$chemical == "metol"] <- "metolachlor"
amphib_dermal_collated$chemical[amphib_dermal_collated$chemical == "tdn"] <- "triadimefon"
amphib_dermal_collated$chemical[amphib_dermal_collated$chemical == "imid"] <- "imidacloprid"
amphib_dermal_collated$chemical[amphib_dermal_collated$chemical == "chloro+d"] <- "chlorothalonil"
amphib_dermal_collated$chemical[amphib_dermal_collated$chemical == "CPF"] <- "chlorpyrifos"
amphib_dermal_collated$chemical[amphib_dermal_collated$chemical == "TFS"] <- "trifloxystrobin"
amphib_dermal_collated$chemical[amphib_dermal_collated$chemical == "FipTOT"] <- "fipronil"
amphib_dermal_collated$chemical[amphib_dermal_collated$chemical == "ATZTOT"] <- "atrazine"
amphib_dermal_collated$chemical[amphib_dermal_collated$chemical == "TNDTOT"] <- "triadimefon"
amphib_dermal_collated$chemical[amphib_dermal_collated$chemical == "Pendi"] <- "pendimethalin"
amphib_dermal_collated$chemical[amphib_dermal_collated$chemical == "Total Atrazine"] <- "atrazine"
amphib_dermal_collated$chemical[amphib_dermal_collated$chemical == "Total Fipronil"] <- "fipronil"
amphib_dermal_collated$chemical[amphib_dermal_collated$chemical == "Total Triadimefon"] <- "triadimefon"


amphib_dermal_collated$chemical <- tolower(amphib_dermal_collated$chemical)
amphib_dermal_collated$chemical <- as.factor(amphib_dermal_collated$chemical)

# write out file
amphib_dermal_collated_filename <- paste(amphibdir_data_out,"amphib_dermal_collated.csv", sep="")
write.csv(amphib_dermal_collated, file=amphib_dermal_collated_filename)
```
#### **Column Names**
```{r eval = TRUE, echo = FALSE, include = TRUE}
colnames(amphib_dermal_collated)
```

#### **Dimensions**
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(amphib_dermal_collated)
```

#### **Variable Summaries**  
```{r eval = TRUE, echo = FALSE, include = TRUE}
summary(amphib_dermal_collated)
```
<br><br><br>

***


**Compare Amphibian Dermal Exposure Data with Proposed Models**
======================================================================
A comparison between the Terrestrial Investigation Model (TIM) and the collected amphibian dermal exposure data will be conducted.  TIM is a probabilistic model simulating multimedia pesticide exposure from food, dermal contact, drinking water, or inhalation exposure routes.

***
```{r eval = TRUE, echo = FALSE}
# read in data again, rename
combined_data_filename <- paste(amphibdir_data_out,"amphib_dermal_collated.csv", sep="")
combined_data <- read.csv(combined_data_filename)
```

<br><br>

***

**TIM (Terrestrial Investigation Model)**
=====================================================================
By default, TIM estimates exposures for birds. The dermal exposure dose (body burden) is computed by combining the pesticide application rate (app_rate), surface area (sa_default_tim), fraction of surface area exposed (sa_tim_default_frac), body weight of the exposed organism (body_weight) and the dermal absorption factor (dermal_af).  

<br>

$$TIM = \frac{AR * SA * SAF * DAF}{BW}$$

```{r eval = TRUE, echo = FALSE, include = FALSE}
colnames(combined_data)
n <- length(combined_data$tissue_conc_ugg)

# bird model with perez body weight
#   we dont care about perez body weights because they are based on large pigeons
# sa_bird_perez <- 65.15 * (body_weight ^ 0.559)
```

***

### **TIM Default Calculation**
```{r eval = TRUE, echo = TRUE}
# Equation 1: TIM Default Values 
app_rate <- combined_data$app_rate_g_cm2
body_weight <- combined_data$body_weight_g
conv_rate <- 1000000.0
dermal_af <- 1.0
hours_one <- 1.0
sa_default_tim <- 10 * (body_weight ^ 0.667) 
sa_tim_default_frac <- 0.5
tissue_conc <- combined_data$tissue_conc_ugg
```

```{r eval = TRUE, echo = TRUE, include = TRUE}
# Calculate Equation 1a: TIM Default
combined_data$tim_direct_default <- (app_rate * conv_rate * sa_default_tim * sa_tim_default_frac * dermal_af)/body_weight
tim_direct_default <- combined_data$tim_direct_default
```

```{r eval = TRUE, echo = TRUE, include = TRUE}
# compute number of histogram bins
bw <- 2*IQR(tim_direct_default) / length(tim_direct_default)^(1/3)

# create frequency histogram
ggplot(combined_data, aes(x=tim_direct_default)) +
  geom_histogram(aes(y = ..count..), color = "#636363", binwidth = bw) +
  scale_x_continuous(name = "Dermal Exposure Dose", breaks = seq(0, 300, 50)) +
  scale_y_continuous(name = "Count", breaks = seq(0, 300, 50)) +
  ggtitle("TIM Default")
```


### **TIM Default Ratios**
Here we compute and visualize the ratio of the TIM Default value to the measured tissue concentrations. A 1:1 ratio signifies perfect agreement between the modeled and measured values.  

```{r eval = TRUE, echo = TRUE}
# Calculate Equation 1b: TIM Default Ratios
combined_data$tim_direct_default_ratios <- combined_data$tim_direct_default/tissue_conc
```

Scatterplots were created to visualize the model's performance, grouped by variables (study, chemical, application type), respectively. The trend line displays the 1:1 ratio.
```{r eval = TRUE, echo = TRUE, include = TRUE}
# create scatterplot, categorized by study
ggplot(combined_data, aes(x = tissue_conc, y = tim_direct_default, color = combined_data$source)) + 
  geom_point() + 
  labs(title = "Modeled vs. Measured, by Study", x = "Measured Tissue Concentrations", y = "TIM Default") +
  geom_abline(intercept = 0, slope = 1) + 
  theme(legend.position = "bottom", legend.title = element_blank())
```

```{r eval = TRUE, echo = TRUE, include = TRUE}
# create scatterplot, categorized by chemical
ggplot(combined_data, aes(x = tissue_conc, y = tim_direct_default, color = combined_data$chemical)) + 
  geom_point() + 
  labs(title = "Modeled vs. Measured, by Chemical", x = "Measured Tissue Concentrations", y = "TIM Default") +
  geom_abline(intercept = 0, slope = 1) +
  theme(legend.position = "bottom", legend.title = element_blank())
```

```{r eval = TRUE, echo = FALSE, include = TRUE}
# create scatterplot, categorized by application type
ggplot(combined_data, aes(x = tissue_conc, y = tim_direct_default, color = combined_data$application)) + 
  geom_point() + 
  labs(title = "Modeled vs. Measured, by Application Type", x = "Measured Tissue Concentrations", y = "TIM Default") +
  geom_abline(intercept = 0, slope = 1) +
  theme(legend.position = "bottom", legend.title = element_blank())
```


***

### **TIM Amphibian Calculation**
To gain a better understanding of pesticide risks on amphibians, the dermal exposure dose was also computed with a modified allometric relationship between body weight and surface area that is better suited for amphibians (Hutchison et al. 1968, EPA 2009).
```{r eval = TRUE, echo = TRUE, include = TRUE}
# Equation 2: TIM Amphibians value (Hutchinson body weight)
sa_amphib_hutchinson <- 1.131 * (body_weight ^ 0.579)
```

```{r eval = TRUE, echo = TRUE, include = TRUE}
# Calculate Equation 2a: TIM Amphibian
combined_data$tim_direct_amphib <- (app_rate * conv_rate * sa_amphib_hutchinson * sa_tim_default_frac * dermal_af)/body_weight

tim_direct_amphib <- combined_data$tim_direct_amphib
```


```{r eval = TRUE, echo = TRUE, include = TRUE}
# compute number of bins
bw <- 2*IQR(tim_direct_amphib) / length(tim_direct_amphib)^(1/3)

# create frequency histogram
ggplot(combined_data, aes(x=tim_direct_amphib)) +
  geom_histogram(aes(y = ..count..), color = "#636363", binwidth = bw) +
  scale_x_continuous(name = "Dermal Exposure Dose", breaks = seq(0, 30, 5)) +
  scale_y_continuous(name = "Count", breaks = seq(0, 300, 50)) +
  ggtitle("TIM Amphibian")
```


### **TIM Amphibian Ratios**
Here we compute and visualize the ratio of the TIM Amphibian values to the measured tissue concentrations. A 1:1 ratio signifies perfect agreement between the modeled and measured values.   
```{r eval = TRUE, echo = TRUE, include = TRUE}
# Calculate Equation 2b: TIM Amphibian Ratios
combined_data$tim_direct_amphib_ratios <- combined_data$tim_direct_amphib/tissue_conc
```

Scatterplots were created to visualize the model's performance, grouped by variables (study, chemical, application type), respectively. The trend line displays the 1:1 ratio.
```{r eval = TRUE, echo = TRUE, include = TRUE}
# create scatterplot, categorized by study
ggplot(combined_data, aes(x = tissue_conc, y = tim_direct_amphib, color = combined_data$source)) + 
  geom_point() + 
  labs(title = "Modeled vs. Measured, by Study", x = "Measured Tissue Concentrations", y = "TIM Amphibian") +
  geom_abline(intercept = 0, slope = 1) +
  theme(legend.position = "bottom", legend.title = element_blank())
```

```{r eval = TRUE, echo = TRUE, include = TRUE}
# create scatterplot, categorized by chemical
ggplot(combined_data, aes(x = tissue_conc, y = tim_direct_amphib, color = combined_data$chemical)) + 
  geom_point() + 
  labs(title = "Modeled vs. Measured, by Chemical", x = "Measured Tissue Concentrations", y = "TIM Amphibian") +
  geom_abline(intercept = 0, slope = 1) +
  theme(legend.position = "bottom", legend.title = element_blank())
```

```{r eval = TRUE, echo = TRUE, include = TRUE}
# create scatterplot, categorized by application type
ggplot(combined_data, aes(x = tissue_conc, y = tim_direct_amphib, color = combined_data$application)) + 
  geom_point() + 
  labs(title = "Modeled vs. Measured, by Application Type", x = "Measured Tissue Concentrations", y = "TIM Amphibian") +
  geom_abline(intercept = 0, slope = 1) +
  theme(legend.position = "bottom", legend.title = element_blank())
```
<br><br>

***

**Assessing Model Performance**
=======================================================
The TIM Default and TIM Amphibian models, described and shown above, were compared to one another and to the post-exposure amphibian body burdens found in the collated data set in order to assess model performance.


```{r eval = TRUE, echo = TRUE, include = TRUE}
# Create df of ratios
model_log_ratios <- as.vector(c(log10(combined_data$tim_direct_default_ratios), 
                        y=log10(combined_data$tim_direct_amphib_ratios)))
model_factor <- as.vector(c(rep('tim_default_direct',n),rep('tim_amphib_direct',n)))
df.ratios <- data.frame(x=model_factor, y=model_log_ratios)

# Create df of tissue_conc and TIM Amphibian
df.tim_amphib <- data.frame(x=tissue_conc, y=tim_direct_amphib)

# Create df of tissue_conc and TIM Default
df.tim_default <- data.frame(x=tissue_conc, y=tim_direct_default)
```

***

### **Comparing Models**
```{r eval = TRUE, echo = TRUE, include = TRUE}
# compare default and amphib ratios
ggplot(df.ratios, aes(x=x, y=y)) + 
  geom_point() + 
  labs(title="TIM Amphibian vs. TIM Default",  x="Model Factor", y = "TIM Value")
```

***

### **Plotting Modeled vs. Measured**

Again, scatterplots comparing the modeled vs. measured values are shown, this time setting models side-by-side. A model along the 1:1 line would display perfect agreement with the measured values.  

```{r eval = TRUE, echo = TRUE, include = TRUE}
# scatterplot of TIM default values
plot_default <- ggplot(df.tim_default, aes(x=x, y=y)) + 
  geom_point() + 
  labs(title="Modeled vs. Measured",  x="Measured Tissue Concentrations", y = "TIM Default") + 
  geom_abline(intercept = 0, slope = 1)

# scatterplot of TIM amphib values
plot_amphib <- ggplot(df.tim_amphib, aes(x=x, y=y)) +
  geom_point() + 
  labs(title="Modeled vs. Measured",  x="Measured Tissue Concentrations", y = "TIM Amphibian ") +
  geom_abline(intercept = 0, slope = 1)

# arrange 1row*2col grid for display
grid.arrange(plot_default, plot_amphib, ncol = 2)
```

***

### **Plotting log10 Ratio of Modeled Burdens to Observed Burdens**

Box plots were utilized to further assess model performance. Well-performing models would minimize error, and therefore would have a higher percentage of ratios near zero (log10 of unity).  
```{r eval = TRUE, echo = TRUE, include = TRUE}
fill <- "#969696"
line <- "#252525"
ggplot(df.ratios, aes(x=x,y=y)) +
    geom_boxplot(fill = fill, colour = line) + 
    scale_x_discrete(name = "Model") +
    scale_y_continuous(name = "log10 of Model-Observation Ratio") +
    theme_bw()
model_boxplot_filename <- paste(amphibdir_graphics,"model_boxplot.png",sep='')
ggsave(model_boxplot_filename, device="png", width=4, height=4)
```

***

### **False Negative Rates**

Summary statistics for false negative rates were also computed for both models. False negative rates are defined as an outcome where the modeled value is less than the measured value. This rate is based on a Type II Error in statistical hypothesis testing. False negative rates assess how often a model under-estimates the measurement of interest.


#### **TIM Default**
As displayed below, there are zero false negative rates for TIM Default. But,  134/1014 (13.2%) of the measurements are within an order of magnitude of the modeled value. 
```{r eval = TRUE, echo = TRUE, include = TRUE}
# False Negative Rate: TIM Default
sum(tissue_conc > tim_direct_default)

# False Negative Rate (x10): TIM Default
sum(tissue_conc*10 > tim_direct_default)
```

#### **TIM Amphibian**
There are 127/1014 (12.5%) false negative screen results for TIM Amphibian, and 786/1014 (77.5%) measurements within an order of magnitude of the modeled value. TIM Amphibian uses a less conservative but more representative surface area calculation for amphibians. 
```{r eval = TRUE, echo = TRUE, include = TRUE}
# False Negative Rate: TIM Amphibian
sum(tissue_conc > tim_direct_amphib)

# False Negative Rate (x10): TIM Amphibian
sum(tissue_conc*10 > tim_direct_amphib)
```

#### **By Study**
False Negative Rates were also computed indiviually by study source. The table below displays the false negative rates and the measurements within an order of magnitude of the modeled value (displayed as %).
```{r eval = TRUE, echo = FALSE, include = FALSE}
# compute FNR by study
unique(combined_data$source)

# subset rvm2015
#View(combined_data)
sub_rvm2015 <- combined_data[combined_data$source == "rvm2015",]
# computations
fnr_default_rvm2015 <- sum(sub_rvm2015$tissue_conc_ugg > sub_rvm2015$tim_direct_default)
fnr10_default_rvm2015 <- sum(sub_rvm2015$tissue_conc_ugg*10 > sub_rvm2015$tim_direct_default)
fnr_amphib_rvm2015 <- sum(sub_rvm2015$tissue_conc_ugg > sub_rvm2015$tim_direct_amphib)
fnr10_amphib_rvm2015 <- sum(sub_rvm2015$tissue_conc_ugg*10 > sub_rvm2015$tim_direct_amphib)
# vector
vec_rvm2015 <- c(fnr_default_rvm2015, fnr10_default_rvm2015, fnr_amphib_rvm2015, fnr10_amphib_rvm2015)
# compute rates
rate_rvm2015 <- vec_rvm2015/nrow(sub_rvm2015)

# subset rvm2015 soil/indirect
sub_rvm2015_soil0 <- combined_data[combined_data$source == "rvm2015",]
#View(sub_rvm2015_soil0)
sub_rvm2015_soil <- sub_rvm2015_soil0[sub_rvm2015_soil0$application == "soil",]
#View(sub_rvm2015_soil)
# computations
fnr_default_rvm2015_soil <- sum(sub_rvm2015_soil$tissue_conc_ugg > sub_rvm2015_soil$tim_direct_default)
fnr10_default_rvm2015_soil <- sum(sub_rvm2015_soil$tissue_conc_ugg*10 > sub_rvm2015_soil$tim_direct_default)
fnr_amphib_rvm2015_soil <- sum(sub_rvm2015_soil$tissue_conc_ugg > sub_rvm2015_soil$tim_direct_amphib)
fnr10_amphib_rvm2015_soil <- sum(sub_rvm2015_soil$tissue_conc_ugg*10 > sub_rvm2015_soil$tim_direct_amphib)
# vector
vec_rvm2015_soil <- c(fnr_default_rvm2015_soil, fnr10_default_rvm2015_soil, fnr_amphib_rvm2015_soil, fnr10_amphib_rvm2015_soil)
# compute rates
rate_rvm2015_soil <- vec_rvm2015_soil/nrow(sub_rvm2015_soil)

# subset rvm2015 overspray/direct
sub_rvm2015_overspray0 <- combined_data[combined_data$source == "rvm2015",]
#View(sub_rvm2015_overspray0)
sub_rvm2015_overspray <- sub_rvm2015_overspray0[sub_rvm2015_overspray0$application == "overspray",]
#View(sub_rvm2015_overspray)
# computations
fnr_default_rvm2015_overspray <- sum(sub_rvm2015_overspray$tissue_conc_ugg > sub_rvm2015_overspray$tim_direct_default)
fnr10_default_rvm2015_overspray <- sum(sub_rvm2015_overspray$tissue_conc_ugg*10 > sub_rvm2015_overspray$tim_direct_default)
fnr_amphib_rvm2015_overspray <- sum(sub_rvm2015_overspray$tissue_conc_ugg > sub_rvm2015_overspray$tim_direct_amphib)
fnr10_amphib_rvm2015_overspray <- sum(sub_rvm2015_overspray$tissue_conc_ugg*10 > sub_rvm2015_overspray$tim_direct_amphib)
# vector
vec_rvm2015_overspray <- c(fnr_default_rvm2015_overspray, fnr10_default_rvm2015_overspray, fnr_amphib_rvm2015_overspray, fnr10_amphib_rvm2015_overspray)
# compute rates
rate_rvm2015_overspray <- vec_rvm2015_overspray/nrow(sub_rvm2015_overspray)


# subset rvm2016
sub_rvm2016 <- combined_data[combined_data$source == "rvm2016",]
# computations
fnr_default_rvm2016 <- sum(sub_rvm2016$tissue_conc_ugg > sub_rvm2016$tim_direct_default)
fnr10_default_rvm2016 <- sum(sub_rvm2016$tissue_conc_ugg*10 > sub_rvm2016$tim_direct_default)
fnr_amphib_rvm2016 <- sum(sub_rvm2016$tissue_conc_ugg > sub_rvm2016$tim_direct_amphib)
fnr10_amphib_rvm2016 <- sum(sub_rvm2016$tissue_conc_ugg*10 > sub_rvm2016$tim_direct_amphib)
# vector
vec_rvm2016 <- c(fnr_default_rvm2016, fnr10_default_rvm2016, fnr_amphib_rvm2016, fnr10_amphib_rvm2016)
# compute rates
rate_rvm2016 <- vec_rvm2016/nrow(sub_rvm2016)


# subset rvm2017
sub_rvm2017 <- combined_data[combined_data$source == "rvm2017",]
# computations
fnr_default_rvm2017 <- sum(sub_rvm2017$tissue_conc_ugg > sub_rvm2017$tim_direct_default)
fnr10_default_rvm2017 <- sum(sub_rvm2017$tissue_conc_ugg*10 > sub_rvm2017$tim_direct_default)
fnr_amphib_rvm2017 <- sum(sub_rvm2017$tissue_conc_ugg > sub_rvm2017$tim_direct_amphib)
fnr10_amphib_rvm2017 <- sum(sub_rvm2017$tissue_conc_ugg*10 > sub_rvm2017$tim_direct_amphib)
# vector 
vec_rvm2017 <- c(fnr_default_rvm2017, fnr10_default_rvm2017, fnr_amphib_rvm2017, fnr10_amphib_rvm2017)
# compute rates
rate_rvm2017 <- vec_rvm2017/nrow(sub_rvm2017)



# subset hr2008
sub_hr2008 <- combined_data[combined_data$source == "hr2008",]
# computations
fnr_default_hr2008 <- sum(sub_hr2008$tissue_conc_ugg > sub_hr2008$tim_direct_default)
fnr10_default_hr2008 <- sum(sub_hr2008$tissue_conc_ugg*10 > sub_hr2008$tim_direct_default)
fnr_amphib_hr2008 <- sum(sub_hr2008$tissue_conc_ugg > sub_hr2008$tim_direct_amphib)
fnr10_amphib_hr2008 <- sum(sub_hr2008$tissue_conc_ugg*10 > sub_hr2008$tim_direct_amphib)
#vector
vec_hr2008 <- c(fnr_default_hr2008, fnr10_default_hr2008, fnr_amphib_hr2008, fnr10_amphib_hr2008)
# compute rates
rate_hr2008 <- vec_hr2008/nrow(sub_hr2008)



# subset dag_metabolites
sub_metabolites <- combined_data[combined_data$source == "dag_metabolites",]
# computations
fnr_default_metabolites <- sum(sub_metabolites$tissue_conc_ugg > sub_metabolites$tim_direct_default)
fnr10_default_metabolites <- sum(sub_metabolites$tissue_conc_ugg*10 > sub_metabolites$tim_direct_default)
fnr_amphib_metabolites <- sum(sub_metabolites$tissue_conc_ugg > sub_metabolites$tim_direct_amphib)
fnr10_amphib_metabolites <- sum(sub_metabolites$tissue_conc_ugg*10 > sub_metabolites$tim_direct_amphib)
# vector
vec_metabolites <- c(fnr_default_metabolites, fnr10_default_metabolites, fnr_amphib_metabolites, fnr10_amphib_metabolites)
# compute rates
rate_metabolites <- vec_metabolites/nrow(sub_metabolites)




# subset dag_dermal_routes
sub_dermal <- combined_data[combined_data$source == "dag_dermal_routes",]
# computations
fnr_default_dermal <- sum(sub_dermal$tissue_conc_ugg > sub_dermal$tim_direct_default)
fnr10_default_dermal <- sum(sub_dermal$tissue_conc_ugg*10 > sub_dermal$tim_direct_default)
fnr_amphib_dermal <- sum(sub_dermal$tissue_conc_ugg > sub_dermal$tim_direct_amphib)
fnr10_amphib_dermal <- sum(sub_dermal$tissue_conc_ugg*10 > sub_dermal$tim_direct_amphib)
# vector
vec_dermal <- c(fnr_default_dermal, fnr10_default_dermal, fnr_amphib_dermal, fnr10_amphib_dermal)
# compute rates
rate_dermal <- vec_dermal/nrow(sub_dermal)



# subset dag_dehydration
sub_dehy <- combined_data[combined_data$source == "dag_dehydration",]
# computations
fnr_default_dehy <- sum(sub_dehy$tissue_conc_ugg > sub_dehy$tim_direct_default)
fnr10_default_dehy <- sum(sub_dehy$tissue_conc_ugg*10 > sub_dehy$tim_direct_default)
fnr_amphib_dehy <- sum(sub_dehy$tissue_conc_ugg > sub_dehy$tim_direct_amphib)
fnr10_amphib_dehy <- sum(sub_dehy$tissue_conc_ugg*10 > sub_dehy$tim_direct_amphib)
# vector
vec_dehy <- c(fnr_default_dehy, fnr10_default_dehy, fnr_amphib_dehy, fnr10_amphib_dehy)
# compute rates
rate_dehy <- vec_dehy/nrow(sub_dehy)


# subset dag_biomarker
sub_bio <- combined_data[combined_data$source == "dag_biomarker",]
# computations
fnr_default_bio <- sum(sub_bio$tissue_conc_ugg > sub_bio$tim_direct_default)
fnr10_default_bio <- sum(sub_bio$tissue_conc_ugg*10 > sub_bio$tim_direct_default)
fnr_amphib_bio <- sum(sub_bio$tissue_conc_ugg > sub_bio$tim_direct_amphib)
fnr10_amphib_bio <- sum(sub_bio$tissue_conc_ugg*10 > sub_bio$tim_direct_amphib)
# vector
vec_bio <- c(fnr_default_bio, fnr10_default_bio, fnr_amphib_bio, fnr10_amphib_bio)
# compute rates
rate_bio <- vec_bio/nrow(sub_bio)



# create matrix of fnr 
sample_size <- c(nrow(sub_rvm2015), nrow(sub_rvm2015_soil), nrow(sub_rvm2015_overspray),
                 nrow(sub_rvm2016), nrow(sub_rvm2017),
                 nrow(sub_hr2008), nrow(sub_metabolites), nrow(sub_dehy),
                 nrow(sub_bio), nrow(sub_dermal))
fnr <- rbind(rate_rvm2015, rate_rvm2015_soil, rate_rvm2015_overspray, 
             rate_rvm2016,rate_rvm2017, 
             rate_hr2008, rate_metabolites, rate_dehy, 
             rate_bio, rate_dermal)
fnr <- round(fnr*100, 2)
fnr <- cbind(sample_size, fnr)
fnr <- as.data.frame(fnr)
names(fnr) <- c("sample_size", "fnr", "fnr_10", "fnr", "fnr_10")
rownames(fnr) <- c("Van Meter 2014/15 total", "Van Meter 2014/15 soil", "Van Meter 2014/15 overspray", "Van Meter 2016", "Van Meter 2018", "Henson-Ramsey 2008", 
                   "Glinski 2018b (Metabolites)", "Glinski 2018a (Dehydration)", "Glinski 2019 (Biomarkers)",
                   "Glinski 2020 (Dermal)")
```

```{r eval = TRUE, echo = FALSE, include = TRUE}
library(knitr)
library(kableExtra)

# create table
kable(fnr) %>%
  kable_styling(c("striped"), full_width = T) %>%
  add_header_above(c(" ", " " = 1, "TIM Default" = 2, "TIM Amphibian" = 2))
  
```


***

### **Comparing Surface Area Calculations** 

While TIM Amphibian had a higher percentage of false negative screening values than TIM Default, the difference in screening values can be attributed to the surface area calculation. Amphibian surface area, as compared to the TIM Default surface area based on birds, is extrapolated from measured body weights. The comparison between surface area calculations is depicted below.    

```{r eval = TRUE, echo = TRUE, include = TRUE}
min_bw <- min(combined_data$body_weight_g, na.rm=T)
max_bw <- max(combined_data$body_weight_g, na.rm=T)
range_bw <- seq(min_bw, max_bw, by = 0.01)
default_sa <- 10*range_bw^0.667
hutchison_sa <- 1.131 * range_bw^0.579
#max(default_sa/hutchison_sa)
sa_data <- data.frame(range_bw, default_sa, hutchison_sa)
ggplot(sa_data, aes(range_bw)) + 
  labs(x = "body weight (g)", y = "Surface Area (cm^2)",color = "Method") +
  geom_line(aes(y = default_sa, colour = "Default")) + 
  geom_line(aes(y = hutchison_sa, colour = "Hutchison")) +
  theme_bw() +
  theme(legend.position =c(0.2,0.8))
  
sa_comparison_filename <- paste(amphibdir_graphics,"sa_comparison.png",sep='')
ggsave(sa_comparison_filename, device="png", width=4, height=4)

```
<br><br><br>

***

Session Information
```{r eval = TRUE, echo = FALSE}
sessionInfo()
```