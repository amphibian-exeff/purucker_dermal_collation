---
title: "Create database of amphibian dermal exposure data"
---

```{r eval=FALSE, echo=FALSE}
#ctrl-shift k to knit r markdown
#https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf
```

Introduction
========================================================
Combining data sets from Van Meter et al. (2014, 2015, 2016) and Glinski (2017a,b)
* https://github.com/puruckertom/VanMeteretal2014_EnvPoll/tree/master/data_in
* https://github.com/puruckertom/VanMeteretal2015_AECT/tree/master/data
vm2015 combines the above 2 (from good_data.csv)
* https://github.com/puruckertom/vanmeteretal2016_etc_amphibian_exposure_som/tree/master/data_in
vm2016 is the above data set (from RDATA.csv)
* https://github.com/puruckertom/glinski_dehydration/tree/master/csv_in
dag_dehy from dehydration3.csv
* https://github.com/puruckertom/glinski_metabolites/tree/master/csv_in
dag_metab from exposure_experiment.csv


Computational environment
========================================================
Location of this repository: 
https://github.com/puruckertom/amphib_data_collation

```{r eval=FALSE, echo=FALSE}
#library(installr) #windows only currently
#updateR()
```
Version and installed libraries.
```{r eval=TRUE, echo=TRUE}
R.Version()$version.string
Sys.info()[4]
```

```{r eval=TRUE, echo=FALSE}
library(ggplot2)
require(gridExtra)
library(reshape2)

# tom mac
if(Sys.info()[4] == "Coiles-MacBook-Pro.local"){
  amphibdir <- path.expand("~/git/amphib_dermal_collation/")
}
#tom computer
if(Sys.info()[4]=="DC2626UTPURUCKE"){
  amphibdir <- "K:\\git\\amphib_dermal_collation\\"
}
#tom computer
if(Sys.info()[4]=="DZ2626UTPURUCKE"){
  amphibdir <- "K:\\git\\amphib_dermal_collation\\"
}
# marcia mac
if(Sys.info()[4] == "Marcias-MacBook-Pro.local"){
  amphibdir <- path.expand("~/git/amphib_dermal_collation/")
}

amphibdir_data_in <- paste(amphibdir,'data_in/',sep='')
amphibdir_data_out <- paste(amphibdir,'data_out/',sep='')
amphibdir_graphics <- paste(amphibdir,'graphics/',sep='')
amphibdir_src <- paste(amphibdir,'src/',sep='')

```

Collating data from relevant studies
========================================================
Van Meter et al. 2014 performed exposures for 5 pesticide (imidacloprid, pendimethalin, atrazine, fipronil, tridimefon) and 7 species (Southern leopard frog (Lithobates sphenocephala), Fowler's toad (Anaxyrus fowleri), gray treefrog (Hyla versicolor), Northern cricket frog (Acris crepitans), Eastern narrowmouth toad (Gastrophryne carolinensis), barking treefrog (Hyla gratiosa) and green treefrog (Hyla cinerea)). Whole body tissue concentrations were measured after an 8 hour exposure period.

Van Meter et al. 2015 contrasted soil only versus overspray exposures for the same 5 pesticides and two of the species (barking treefrog (Hyla gratiosa) and green treefrog (Hyla cinerea)), so for our purposes essentially adds the aerial overspray exposures to the above data set.

Original file with analytical data: 
https://github.com/puruckertom/VanMeteretal2016_ple_v_ols/blob/master/RDATA.csv
https://github.com/puruckertom/VanMeteretal2015_AECT/tree/master/data/good_data.csv

```{r eval=TRUE, echo=FALSE}
##################
#the data sets
##################
# import data from Van Meter 2014 and 2015 papers.
vm2015_file <- paste(amphibdir_data_in,"vm2014_data.csv", sep="")
file.exists(vm2015_file)
vm2015 <- read.table(vm2015_file, header = TRUE, sep = ",")
dim(vm2015)
summary(vm2015)
#View(vm2015)

# import data from Van Meter 2016
vm2016_file <- paste(amphibdir_data_in,"vm2016_data.csv", sep="")
file.exists(vm2016_file)
vm2016 <- read.table(vm2016_file, header = TRUE, sep = ",")
dim(vm2016)
summary(vm2016)
#View(vm2016)

# import data from Glinski 2016 dehydration study
dag2016_dehy_file <- paste(amphibdir_data_in,"dag2016_data_dehydration.csv", sep="")
file.exists(dag2016_dehy_file)
dag2016_dehy <- read.table(dag2016_dehy_file, header = TRUE, sep = ",")
dim(dag2016_dehy)
summary(dag2016_dehy)
#View(dag2016_dehy)

```

```{r eval=TRUE, echo=FALSE}
##################
#van meter 2014/15
##################
unique(vm2015$Chemical)
#drop metabolites and parents that do not include metabolites
vm2015_chem_drop <- c("Atrazine","Deisopropyl Atrazine","Desethyl Atrazine","Fipronil","Fipronil-Sulfone","Triadimefon","Triadimenol")
chem_vector_drop <- which(vm2015$Chemical %in% vm2015_chem_drop)
vm2015_subset1 <- vm2015[-chem_vector_drop,]
vm2015_subset2 <- droplevels(vm2015_subset1)
#drop unneeded columns for merging
#View(vm2015_subset2)
all_cols <- colnames(vm2015_subset2)
drop_cols <- c("Instrument", "good", "logKow", "BCF", "initialweight", 
            "Solat20C_mgL", "Solat20C_gL", "molmass_gmol", "Density_gcm3","AppFactor", "SA_cm2", "VapPrs_mPa",
            "Koc_gmL", "HalfLife_day", "HabFac")
vm2015_subset3 <- vm2015_subset2[,!(names(vm2015_subset2) %in% drop_cols)]
colnames(vm2015_subset3)
#add columns
soil_type <- c(rep("PLE",nrow(vm2015_subset3)))
formulation <- (rep(0,nrow(vm2015_subset3)))
exp_duration<- (rep(8,nrow(vm2015_subset3)))
vm2015_subset4 <- cbind(vm2015_subset3, formulation, soil_type, exp_duration)
# standardize column names
colnames(vm2015_subset4)
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="Sample")]<-"sample_id"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="Species")]<-"species"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="Chemical")]<-"chemical"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="Application")]<-"application"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="TissueConc")]<-"tissue_conc_ugg"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="SoilConc")]<-"soil_conc_ugg"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="bodyweight")]<-"body_weight_g"
colnames(vm2015_subset4)
#reorder vm2015 alphabetically
vm2015_merge <- vm2015_subset4[,order(names(vm2015_subset4))]
dim(vm2015_merge)
colnames(vm2015_merge)
#write a local copy
vm2015_merge_filename <- paste(amphibdir_data_out,"vm2015_merge.csv", sep="")
write.csv(vm2015_merge, file=vm2015_merge_filename)

```


Reformat vm2016 for merge with vm2015
```{r eval=TRUE, echo=FALSE}
##################
#van meter 2016
##################
dim(vm2016)
colnames(vm2016)
#add sample_id
vm2016$sample_id <- paste(vm2016$Day, vm2016$Row, vm2016$Column, sep="_")
vm2016_subset2 <- subset(vm2016, select=c(-Day,-Row, -Column, -Total))
Species <- c(rep("American toad",nrow(vm2016_subset2)))
Application <- c(rep("Indirect",nrow(vm2016_subset2)))
Exp_duration<- (rep(8,nrow(vm2016_subset2)))
vm2016_subset3 <- cbind(vm2016_subset2, Species, Application, Exp_duration)
#assign values to application rate
unique(vm2016_subset3$Pesticide)
colnames(vm2016_subset3)
vm2016_subset3$app_rate_g_cm2[vm2016_subset3$Pesticide=="ATZTOT"] <- 22.9e-6
vm2016_subset3$app_rate_g_cm2[vm2016_subset3$Pesticide=="Imid"] <- 5.7e-6
vm2016_subset3$app_rate_g_cm2[vm2016_subset3$Pesticide=="FipTOT"] <- 1.1e-6
vm2016_subset3$app_rate_g_cm2[vm2016_subset3$Pesticide=="TNDTOT"] <- 2.7e-6
vm2016_subset3$app_rate_g_cm2[vm2016_subset3$Pesticide=="Pendi"] <- 69.8e-6
colnames(vm2016_subset3)
#drop decay products that were not sprayed, keeping only parents
rows_to_drop <- which(vm2016_subset3$Parent == 0)
vm2016_subset4 <- vm2016_subset3[-rows_to_drop,]
#drop ATZ,Fip, TDN since does not include metabolites in total
chems_to_drop <- c("ATZ","Fip","TDN")
vm2016_subset5 <- vm2016_subset4[!(vm2016_subset4$Pesticide %in% chems_to_drop),]
#now drop parent field
drop_cols <- c("Parent")
vm2016_subset6 <- vm2016_subset5[,!(names(vm2016_subset5) %in% drop_cols)]
# standardize column names
#View(vm2016_subset4)
colnames(vm2016_subset6)
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="Pesticide")]<-"chemical"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="SoilType")]<-"soil_type"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="BodyBurden")]<-"tissue_conc_ugg"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="Soil")]<-"soil_conc_ugg"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="Weight")]<-"body_weight_g"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="Formulation")]<-"formulation"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="Species")]<-"species"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="Application")]<-"application"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="Exp_duration")]<-"exp_duration"
# reorder columns alphabetically to help with merge
#reorder vm2016
colnames(vm2016_subset6)
vm2016_merge <- vm2016_subset6[,order(names(vm2016_subset6))]
dim(vm2016_merge)
colnames(vm2016_merge)
#write a local copy
vm2016_merge_filename <- paste(amphibdir_data_out,"vm2016_merge.csv", sep="")
write.csv(vm2016_merge, file=vm2016_merge_filename)
```

Combine two Van Meter et al. datasets

```{r eval=TRUE, echo=FALSE}
colnames(vm2015_merge)
colnames(vm2016_merge)
dim(vm2015_merge)
dim(vm2016_merge)
# combine two dataframes
combined_data <- rbind(vm2015_merge, vm2016_merge)
dim(combined_data)
colnames(combined_data)
#View(combined_data)
combined_data_filename <- paste(amphibdir_data_out,"combined_data.csv", sep="")
write.csv(combined_data, file=combined_data_filename)
```

Revise dag2016_dehy to merge with van meter data sets
```{r eval=TRUE, echo=FALSE}
##################
#glinski et al 2017 dehydration
##################
dim(dag2016_dehy)
colnames(dag2016_dehy)
#View(dag2016_dehy)
#from
#[1] "time"    "parent"  "analyte" "matrix"  "species" "conc"    "ID"      "weight"
#to
# [1] "chemical"        "soil_type"       "tissue_conc_ugg" "soil_conc_ugg"   "body_weight_g"  
# [6] "formulation"     "species"         "application"     "exp_duration"    "app_rate_g_cm2" 
# time change to exp_duration
colnames(dag2016_dehy)[which(colnames(dag2016_dehy)=="time")]<-"exp_duration"
# analyte change to chemical
colnames(dag2016_dehy)[which(colnames(dag2016_dehy)=="analyte")]<-"chemical"
# species same
# change ID to sample_id
colnames(dag2016_dehy)[which(colnames(dag2016_dehy)=="ID")]<-"sample_id"
# weight change to body_weight_g
colnames(dag2016_dehy)[which(colnames(dag2016_dehy)=="weight")]<-"body_weight_g"
# add soil_type (PLE, OLS), formulation (0,1), application (Overspray, Indirect) and app_rate_g_cm2 fields
soil_type <- c(rep("PLE",nrow(dag2016_dehy)))
application <- c(rep("Indirect",nrow(dag2016_dehy)))
formulation <- (rep(0,nrow(dag2016_dehy)))
app_rate_g_cm2 <- (rep(0,nrow(dag2016_dehy)))
dag2016_dehy2 <- cbind(dag2016_dehy, formulation, soil_type, application, app_rate_g_cm2)
# parent delete
drop_cols <- c("parent")
dag2016_dehy3 <- dag2016_dehy2[,!(names(dag2016_dehy2) %in% drop_cols)]
#reshape- cast takes long-format data and casts it into wide-format data
# matrix used to split to soil and amphibian conc columns and delete
# conc split to soil and amphibian conc columns
#make wide with soil and amphib concentrations
colnames(dag2016_dehy3)
#View(dag2016_dehy3)
dag2016_dehy4 <- dcast(dag2016_dehy3, 
                       sample_id + exp_duration + chemical + species +
                         body_weight_g + formulation + soil_type + application + app_rate_g_cm2 ~ 
                         matrix, 
                       value.var = "conc")
colnames(dag2016_dehy4)
#View(dag2016_dehy4)



```
