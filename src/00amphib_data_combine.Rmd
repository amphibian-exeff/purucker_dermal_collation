---
title: "Create database of amphibian dermal exposure data"
---

```{r eval=FALSE, echo=FALSE}
#ctrl-shift k to knit r markdown
#https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf
```

Introduction
========================================================
Combining data sets from Van Meter et al. (2014, 2015, 2016) and Glinski (2017a,b)
* https://github.com/puruckertom/VanMeteretal2014_EnvPoll/tree/master/data_in
* https://github.com/puruckertom/VanMeteretal2015_AECT/tree/master/data
vm2015 combines the above 2 (from good_data.csv)
* https://github.com/puruckertom/vanmeteretal2016_etc_amphibian_exposure_som/tree/master/data_in
vm2016 is the above data set (from RDATA.csv)
* https://github.com/puruckertom/glinski_dehydration/tree/master/csv_in
dag_dehy from dehydration3.csv
* https://github.com/puruckertom/glinski_metabolites/tree/master/csv_in
dag_metab from exposure_experiment.csv


Computational environment
========================================================
Location of this repository: 
https://github.com/puruckertom/amphib_data_collation

```{r eval=FALSE, echo=FALSE}
#library(installr) #windows only currently
#updateR()
```
Version and installed libraries.
```{r eval=TRUE, echo=TRUE}
R.Version()$version.string
Sys.info()[4]
```

```{r eval=TRUE, echo=FALSE}
library(ggplot2)
require(gridExtra)
library(reshape2)

# tom mac
if(Sys.info()[4] == "Coiles-MacBook-Pro.local"){
  amphibdir <- path.expand("~/git/amphib_dermal_collation/")
}
#tom computer
if(Sys.info()[4]=="DZ2626UTPURUCKE"){
  amphibdir <- "K:\\git\\amphib_dermal_collation\\"
}
# marcia mac
if(Sys.info()[4] == "Marcias-MacBook-Pro.local"){
  amphibdir <- path.expand("~/git/amphib_dermal_collation/")
}

amphibdir_data_in <- paste(amphibdir,'data_in/',sep='')
amphibdir_data_out <- paste(amphibdir,'data_out/',sep='')
amphibdir_graphics <- paste(amphibdir,'graphics/',sep='')
amphibdir_src <- paste(amphibdir,'src/',sep='')

```

Collating data from relevant studies
========================================================
Van Meter et al. 2014 performed exposures for 5 pesticide (imidacloprid, pendimethalin, atrazine, fipronil, tridimefon) and 7 species (Southern leopard frog (Lithobates sphenocephala), Fowler's toad (Anaxyrus fowleri), gray treefrog (Hyla versicolor), Northern cricket frog (Acris crepitans), Eastern narrowmouth toad (Gastrophryne carolinensis), barking treefrog (Hyla gratiosa) and green treefrog (Hyla cinerea)). Whole body tissue concentrations were measured after an 8 hour exposure period.

Van Meter et al. 2015 contrasted soil only versus overspray exposures for the same 5 pesticides and two of the species (barking treefrog (Hyla gratiosa) and green treefrog (Hyla cinerea)), so for our purposes essentially adds the aerial overspray exposures to the above data set.

Original file with analytical data: 
https://github.com/puruckertom/VanMeteretal2016_ple_v_ols/blob/master/RDATA.csv
https://github.com/puruckertom/VanMeteretal2015_AECT/tree/master/data/good_data.csv

```{r eval=TRUE, echo=FALSE}
##################
#the data sets
##################
# import data from Van Meter 2014 and 2015 papers.
vm2015_file <- paste(amphibdir_data_in,"vm2014_data.csv", sep="")
file.exists(vm2015_file)
vm2015 <- read.table(vm2015_file, header = TRUE, sep = ",")
dim(vm2015)
summary(vm2015)
#View(vm2015)

# import data from Van Meter 2016
vm2016_file <- paste(amphibdir_data_in,"vm2016_data.csv", sep="")
file.exists(vm2016_file)
vm2016 <- read.table(vm2016_file, header = TRUE, sep = ",")
dim(vm2016)
summary(vm2016)
#View(vm2016)

# import data from Glinski 2016 dehydration study
dag2016_dehy_file <- paste(amphibdir_data_in,"dag2016_data_dehydration.csv", sep="")
file.exists(dag2016_dehy_file)
dag2016_dehy0 <- read.table(dag2016_dehy_file, header = TRUE, sep = ",")
dim(dag2016_dehy0)
summary(dag2016_dehy0)
#View(dag2016_dehy)

# import data from Henson-Ramsey 2008
hr2008_file <- paste(amphibdir_data_in,"hr2008_data.csv", sep="")
file.exists(hr2008_file)
hr2008 <- read.table(hr2008_file, header = TRUE, sep = ",")
dim(hr2008)
summary(hr2008)

# import data from Glinski 2017 metabolite study
dag2016_metabolite_file <- paste(amphibdir_data_in,"dag2016_data_metabolites.csv", sep="")
file.exists(dag2016_metabolite_file)
dag2016_metabolite0 <- read.table(dag2016_metabolite_file, header = TRUE, sep = ",")
dim(dag2016_metabolite0)
summary(dag2016_metabolite0)
#View(dag2016_metabolite)

# import data from Glinski 2017 metabolite study
dag2016_metabolite_merge_file <- paste(amphibdir_data_in,"dag2016_data_metabolites_4merge.csv", sep="")
file.exists(dag2016_metabolite_merge_file)
dag2016_metabolite_merge <- read.table(dag2016_metabolite_merge_file, header = TRUE, sep = ",")
dim(dag2016_metabolite_merge)
colnames(dag2016_metabolite_merge)
summary(dag2016_metabolite_merge)
#View(dag2016_metabolite)

# import data from Van Meter 2017 herbs
rvm2017_herbs_file <- paste(amphibdir_data_in,"vm2017_herbs.csv", sep="")
file.exists(rvm2017_herbs_file)
rvm2017_herbs0 <- read.table(rvm2017_herbs_file, header = TRUE, sep = ",")
dim(rvm2017_herbs0)
summary(rvm2017_herbs0)
#View(rvm2017_herbs0)
# import data from Van Meter 2017 hif
rvm2017_hif_file <- paste(amphibdir_data_in,"vm2017_hif.csv", sep="")
file.exists(rvm2017_hif_file)
rvm2017_hif0 <- read.table(rvm2017_hif_file, header = TRUE, sep = ",")
dim(rvm2017_hif0)
summary(rvm2017_hif0)
#View(rvm2017_hif0)
rvm2017_merge_file <- paste(amphibdir_data_in,"vm2017_merge.csv", sep="")
file.exists(rvm2017_merge_file)
rvm2017_merge <- read.table(rvm2017_merge_file, header = TRUE, sep = ",")
dim(rvm2017_merge)
summary(rvm2017_merge)
#View(rvm2017_merge)

```



```{r eval=TRUE, echo=FALSE}
##################
#van meter 2014/15
##################
unique(vm2015$Chemical)
#drop metabolites and parents that do not include metabolites
vm2015_chem_drop <- c("Atrazine","Deisopropyl Atrazine","Desethyl Atrazine","Fipronil","Fipronil-Sulfone","Triadimefon","Triadimenol")
chem_vector_drop <- which(vm2015$Chemical %in% vm2015_chem_drop)
vm2015_subset1 <- vm2015[-chem_vector_drop,]
vm2015_subset2 <- droplevels(vm2015_subset1)
#drop unneeded columns for merging
#View(vm2015_subset2)
all_cols <- colnames(vm2015_subset2)
drop_cols <- c("Instrument", "good", "logKow", "BCF", "initialweight", 
            "Solat20C_mgL", "Solat20C_gL", "molmass_gmol", "Density_gcm3","AppFactor", "SA_cm2", "VapPrs_mPa",
            "Koc_gmL", "HalfLife_day", "HabFac")
vm2015_subset3 <- vm2015_subset2[,!(names(vm2015_subset2) %in% drop_cols)]
colnames(vm2015_subset3)
#add columns
soil_type <- c(rep("PLE",nrow(vm2015_subset3)))
formulation <- (rep(0,nrow(vm2015_subset3)))
exp_duration<- (rep(8,nrow(vm2015_subset3)))
source <- c(rep("rvm2015",nrow(vm2015_subset3)))
vm2015_subset4 <- cbind(vm2015_subset3, formulation, soil_type, exp_duration, source)
# standardize column names
colnames(vm2015_subset4)
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="Sample")]<-"sample_id"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="Species")]<-"species"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="Chemical")]<-"chemical"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="Application")]<-"application"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="TissueConc")]<-"tissue_conc_ugg"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="SoilConc")]<-"soil_conc_ugg"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="bodyweight")]<-"body_weight_g"
colnames(vm2015_subset4)
#reorder vm2015 alphabetically
vm2015_merge <- vm2015_subset4[,order(names(vm2015_subset4))]
dim(vm2015_merge)
colnames(vm2015_merge)
#write a local copy
vm2015_merge_filename <- paste(amphibdir_data_out,"vm2015_merge.csv", sep="")
write.csv(vm2015_merge, file=vm2015_merge_filename)

```


Reformat vm2016 for merge with vm2015
```{r eval=TRUE, echo=FALSE}
##################
#van meter 2016
##################
dim(vm2016)
colnames(vm2016)
#add sample_id
vm2016$sample_id <- paste(vm2016$Day, vm2016$Row, vm2016$Column, sep="_")
vm2016_subset2 <- subset(vm2016, select=c(-Day,-Row, -Column, -Total))
species <- c(rep("American toad",nrow(vm2016_subset2)))
application <- c(rep("Indirect",nrow(vm2016_subset2)))
exp_duration<- (rep(8,nrow(vm2016_subset2)))
source <- c(rep("rvm2016",nrow(vm2016_subset2)))
vm2016_subset3 <- cbind(vm2016_subset2, species, application, exp_duration, source)
#assign values to application rate
unique(vm2016_subset3$Pesticide)
colnames(vm2016_subset3)
vm2016_subset3$app_rate_g_cm2[vm2016_subset3$Pesticide=="ATZTOT"] <- 22.9e-6
vm2016_subset3$app_rate_g_cm2[vm2016_subset3$Pesticide=="Imid"] <- 5.7e-6
vm2016_subset3$app_rate_g_cm2[vm2016_subset3$Pesticide=="FipTOT"] <- 1.1e-6
vm2016_subset3$app_rate_g_cm2[vm2016_subset3$Pesticide=="TNDTOT"] <- 2.7e-6
vm2016_subset3$app_rate_g_cm2[vm2016_subset3$Pesticide=="Pendi"] <- 69.8e-6
colnames(vm2016_subset3)
#drop decay products that were not sprayed, keeping only parents
rows_to_drop <- which(vm2016_subset3$Parent == 0)
vm2016_subset4 <- vm2016_subset3[-rows_to_drop,]
#drop ATZ,Fip, TDN since does not include metabolites in total
chems_to_drop <- c("ATZ","Fip","TDN")
vm2016_subset5 <- vm2016_subset4[!(vm2016_subset4$Pesticide %in% chems_to_drop),]
#now drop parent field
drop_cols <- c("Parent")
vm2016_subset6 <- vm2016_subset5[,!(names(vm2016_subset5) %in% drop_cols)]
# standardize column names
#View(vm2016_subset4)
colnames(vm2016_subset6)
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="Pesticide")]<-"chemical"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="SoilType")]<-"soil_type"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="BodyBurden")]<-"tissue_conc_ugg"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="Soil")]<-"soil_conc_ugg"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="Weight")]<-"body_weight_g"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="Formulation")]<-"formulation"

# reorder columns alphabetically to help with merge
#reorder vm2016
colnames(vm2016_subset6)
vm2016_merge <- vm2016_subset6[,order(names(vm2016_subset6))]
dim(vm2016_merge)
colnames(vm2016_merge)
#write a local copy
vm2016_merge_filename <- paste(amphibdir_data_out,"vm2016_merge.csv", sep="")
write.csv(vm2016_merge, file=vm2016_merge_filename)
```

Combine two Van Meter et al. datasets

```{r eval=TRUE, echo=FALSE}
#View(vm2015_merge)
#View(vm2016_merge)
colnames(vm2015_merge)
colnames(vm2016_merge)
dim(vm2015_merge)
dim(vm2016_merge)
# combine two dataframes
combined_data0 <- rbind(vm2015_merge, vm2016_merge)
dim(combined_data0)
colnames(combined_data0)
#View(combined_data0)
combined_data_filename0 <- paste(amphibdir_data_out,"combined_data0.csv", sep="")
write.csv(combined_data0, file=combined_data_filename0)
```

Revise dag2016_dehy to merge with van meter data sets
```{r eval=TRUE, echo=FALSE}
##################
#glinski et al 2017 dehydration
##################
dim(dag2016_dehy0)
colnames(dag2016_dehy0)
#View(dag2016_dehy)
#from
#[1] "time"    "parent"  "analyte" "matrix"  "species" "conc"    "ID"      "weight"
#to
# [1] "chemical"        "soil_type"       "tissue_conc_ugg" "soil_conc_ugg"   "body_weight_g"  
# [6] "formulation"     "species"         "application"     "exp_duration"    "app_rate_g_cm2" 
# drop metabolite products
parent_keepers <- which(as.vector(dag2016_dehy0$parent) == as.vector(dag2016_dehy0$analyte))
dag2016_dehy1 <- dag2016_dehy0[parent_keepers,]
## time is length of dehydration
#colnames(dag2016_dehy1)[which(colnames(dag2016_dehy1)=="time")]<-"exp_duration"
# analyte change to chemical
colnames(dag2016_dehy1)[which(colnames(dag2016_dehy1)=="analyte")]<-"chemical"
# conc to tissue concs
colnames(dag2016_dehy1)[which(colnames(dag2016_dehy1)=="conc")]<-"tissue_conc_ugg"
# species same
# change ID to sample_id
colnames(dag2016_dehy1)[which(colnames(dag2016_dehy1)=="ID")]<-"sample_id"
# weight change to body_weight_g
colnames(dag2016_dehy1)[which(colnames(dag2016_dehy1)=="weight")]<-"body_weight_g"
# add soil_type (PLE, OLS), formulation (0,1), application (Overspray, Indirect) and app_rate_g_cm2 fields
exp_duration <- c(rep(8,nrow(dag2016_dehy1)))
soil_type <- c(rep("PLE",nrow(dag2016_dehy1)))
application <- c(rep("Indirect",nrow(dag2016_dehy1)))
formulation <- (rep(0,nrow(dag2016_dehy1)))
app_rate_g_cm2 <- (rep(0,nrow(dag2016_dehy1)))
soil_conc_ugg <- (rep(0,nrow(dag2016_dehy1)))
source <- c(rep("dag_dehydration",nrow(dag2016_dehy1)))
dag2016_dehy2 <- cbind(dag2016_dehy1, formulation, soil_type, application, 
                       app_rate_g_cm2, exp_duration, soil_conc_ugg, source)
#reshape- cast takes long-format data and casts it into wide-format data
# matrix used to split to soil and amphibian conc columns and delete
# conc split to soil and amphibian conc columns
#make wide with soil and amphib concentrations
colnames(dag2016_dehy2)
#View(dag2016_dehy3)
#multiple soil concentration observations per id
dag2016_dehy_mergefail <- dcast(dag2016_dehy3, 
                       tissue_conc_ugg + sample_id + species + chemical + exp_duration ~ matrix, 
                       value.var = c("tissue_conc_ugg"))
#View(dag2016_mergefail)
#drop the soil until we can do a many-to-one merge of soil concentrations
#drop decay products that were not sprayed, keeping only parents
rows_to_drop <- which(dag2016_dehy2$matrix == 'soil')
dag2016_dehy3 <- dag2016_dehy2[-rows_to_drop,]
# parent, time and matrix columns delete
drop_cols <- c("parent","time","matrix")
dag2016_dehy4 <- dag2016_dehy3[,!(names(dag2016_dehy3) %in% drop_cols)]
#View(dag2016_dehy4)
unique(dag2016_dehy4$chemical)
update_atrazine <- which(dag2016_dehy4$chemical == 'atrazine')
dag2016_dehy4$app_rate_g_cm2[update_atrazine] <- 0.00002395 # atrazine g/cm2
update_chloro <- which(dag2016_dehy4$chemical == 'chloro')
dag2016_dehy4$app_rate_g_cm2[update_chloro] <-  0.0000443 # chloro g/cm2
update_metol <- which(dag2016_dehy4$chemical == 'metol')
dag2016_dehy4$app_rate_g_cm2[update_metol] <-  0.00003101 # metol g/cm2
update_tdn <- which(dag2016_dehy4$chemical == 'tdn')
dag2016_dehy4$app_rate_g_cm2[update_tdn] <- 0.00000291 # tdn g/cm2
update_imid <- which(dag2016_dehy4$chemical == 'imid')
dag2016_dehy4$app_rate_g_cm2[update_imid] <- 0.00000539 # imid g/cm2
dim(dag2016_dehy4)
#View(dag2016_dehy5)
#temporarily set chloro parent to 100 pending summing daughter metabolites
dag2016_dehy4$tissue_conc_ugg[update_chloro] <-  0

# reorder columns alphabetically to help with merge
#reorder dag2016_dehy4
colnames(dag2016_dehy4)
dag2016_dehy_merge <- dag2016_dehy4[,order(names(dag2016_dehy4))]
dim(dag2016_dehy_merge)
colnames(dag2016_dehy_merge)
#write a local copy
dag2016_dehy_merge_filename <- paste(amphibdir_data_out,"dag2016_dehy_merge.csv", sep="")
write.csv(dag2016_dehy_merge, dag2016_dehy_merge_filename)

```
Combine Van Meters with Glinski dehydration

```{r eval=TRUE, echo=FALSE}
#View(dag2016_dehy_merge)
colnames(combined_data0)
colnames(dag2016_dehy_merge)
dim(combined_data0)
dim(dag2016_dehy_merge)
# combine two dataframes
combined_data1 <- rbind(combined_data0, dag2016_dehy_merge)
dim(combined_data1)
colnames(combined_data1)
rownames(combined_data1) <- seq(length=nrow(combined_data1))
#View(combined_data1)
combined_data_filename1 <- paste(amphibdir_data_out,"combined_data1.csv", sep="")
write.csv(combined_data1, file=combined_data_filename1)
```

Merge Henson-Ramsey 2008 data with combined data set

```{r eval=TRUE, echo=FALSE}
colnames(combined_data1)
colnames(hr2008)
dim(combined_data1)
dim(hr2008)
# combine two dataframes
combined_data2 <- rbind(combined_data1, hr2008)
dim(combined_data2)
colnames(combined_data2)
rownames(combined_data2) <- seq(length=nrow(combined_data2))
colnames(combined_data2)
#View(combined_data2)
combined_data_filename2 <- paste(amphibdir_data_out,"combined_data2.csv", sep="")
write.csv(combined_data2, file=combined_data_filename2)
```


Revise glinski_metabolites to merge.

```{r eval=TRUE, echo=FALSE}

##################
#glinski et al 2017 metabolites
##################
dim(dag2016_metabolite_merge)
colnames(dag2016_metabolite_merge)
#View(dag2016_metabolite_merge)
# combine two dataframes
combined_data3 <- rbind(combined_data2, dag2016_metabolite_merge)
dim(combined_data3)
colnames(combined_data3)
rownames(combined_data3) <- seq(length=nrow(combined_data3))
colnames(combined_data3)
#View(combined_data3)
combined_data_filename3 <- paste(amphibdir_data_out,"combined_data3.csv", sep="")
write.csv(combined_data3, file=combined_data_filename3)
```

Merge Van Meter 2017 multiple pesticides study
rvm2017_merge

```{r eval=TRUE, echo=FALSE}

##################
#van meter et al 2017 multi-pesticide study merge
##################
dim(rvm2017_merge)
colnames(rvm2017_merge)
#View(rvm2017_merge)
# combine two dataframes
combined_data4 <- rbind(combined_data3, rvm2017_merge)
dim(combined_data4)
colnames(combined_data4)
rownames(combined_data4) <- seq(length=nrow(combined_data4))
colnames(combined_data4)
#View(combined_data4)
combined_data_filename4 <- paste(amphibdir_data_out,"combined_data4.csv", sep="")
write.csv(combined_data4, file=combined_data_filename4)
```

final product, fix soil concs

```{r eval=TRUE, echo=FALSE}
##################
#write out the entire final product
##################
amphib_dermal_collated <- combined_data4
#View(amphib_dermal_collated)
colnames(amphib_dermal_collated)
#check to see if everything ok
summary(amphib_dermal_collated$app_rate_g_cm2) # units issues
summary(amphib_dermal_collated$body_weight_g) # 60 NAs
summary(amphib_dermal_collated$exp_duration)
summary(amphib_dermal_collated$soil_conc_ugg) # 206 NAs
summary(amphib_dermal_collated$tissue_conc_ugg)

amphib_dermal_collated_filename <- paste(amphibdir_data_out,"amphib_dermal_collated.csv", sep="")
write.csv(amphib_dermal_collated, file=amphib_dermal_collated_filename)
```