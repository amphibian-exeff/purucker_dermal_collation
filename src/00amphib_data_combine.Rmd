---
title: "Creating a Database of Amphibian Dermal Exposure Data"
---

```{r eval=FALSE, echo=FALSE}
#ctrl-shift k to knit r markdown
#https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf
```

***

**Introduction**
========================================================

The purpose of this script is to combine the data sets from Van Meter et al. (2014, 2015, 2016, 2018) and Glinski (2018a, b, c), and Henson-Ramsey (2008) to create a collated database of amphibian dermal exposure data.    

| Manuscript | Link | Meta |
| --------------- |:------------------ |:--------------- |
| <a href= "https://www.sciencedirect.com/science/article/pii/S0269749114002899?via%3Dihub">Van Meter et al. 2014 | <a href="https://github.com/puruckertom/VanMeteretal2014_EnvPoll/tree/master/data_in">good_data.csv</a> | |
| <a href="https://link.springer.com/article/10.1007%2Fs00244-015-0183-2">Van Meter et al. 2015 | <a href="https://github.com/puruckertom/VanMeteretal2015_AECT/tree/master/data">good_data.csv</a>| |
| <a href="https://setac.onlinelibrary.wiley.com/doi/full/10.1002/etc.3439">Van Meter et al. 2016 | <a href="https://github.com/puruckertom/vanmeteretal2016_etc_amphibian_exposure_som/tree/master/data_in">RDATA.csv</a>| |
| <a href="https://www.sciencedirect.com/science/article/pii/S004896971733601X?via%3Dihub">Van Meter et al. 2018 | <a href="https://github.com/puruckertom/amphib_dermal_collation/blob/master/data_in/vm2017_merge.csv">vm2017_merge.csv</a>| |
| <a href="https://link.springer.com/article/10.1007%2Fs11356-018-1830-8">Glinski et al. 2018a (dehydration) | <a href="https://github.com/puruckertom/glinski_dehydration/tree/master/csv_in">  </a>| dag_dehy from dehydration3.csv | 
| <a href="https://www.sciencedirect.com/science/article/pii/S0378427418300626?via%3Dihub">Glinski et al. 2018b (metabolites) </a>| <a href="https://github.com/puruckertom/glinski_metabolites/tree/master/csv_in"> </a>| dag_metab from exposure_experiment.csv |
| <a href= "http://www.publish.csiro.au/en/EN18163">Glinski et al. 2018c (biomarkers) | <a href="https://github.com/puruckertom/glinski_biomarkers/tree/master/csv_in">exposure_mixture3.csv</a>| dag_mbiomarker from exposure_mixture3.csv | 
| <a href="https://link.springer.com/article/10.1007/s00244-007-9091-4">Henson-Ramsey 2008 | |  |

  

***


**Computational environment**
========================================================
This repository can be found at: 
https://github.com/puruckertom/amphib_dermal_collation

If you are on a Mac and get xquartz complaints (knitr), install from:
https://www.xquartz.org/


```{r eval=FALSE, echo=FALSE}
#library(installr) #windows only currently
#updateR()
```
```{r eval = TRUE, echo = FALSE, include = FALSE}
# You are using the following R Version and System
R.Version()$version.string
Sys.info()[4]
```

```{r eval = TRUE, echo = FALSE, include = FALSE}
# Install required libraries
library(ggplot2)
require(gridExtra)
library(reshape2)

# Update according to the System you are using...
# tom epa linux
if(Sys.info()[4] == "d2626ut7920d.rtpnc.epa.gov"){
  amphibdir <- path.expand("~/git/amphib_dermal_collation/")
}
# tom mac
if(Sys.info()[4] == "Coiles-MacBook-Pro.local" | Sys.info()[4] == "Coiles-MBP"
   | Sys.info()[4] == "Toms-Air"){
  amphibdir <- path.expand("~/git/amphib_dermal_collation/")
}
# tom computer
if(Sys.info()[4]=="DZ2626UTPURUCKE"){
  amphibdir <- "K:\\git\\amphib_dermal_collation\\"
}
# marcia mac
if(Sys.info()[4] == "Marcias-MacBook-Pro.local"){
  amphibdir <- path.expand("~/git/amphib_dermal_collation/")
}
# Sumathy's window
if(Sys.info()[4]=="DZ2626USSINNATH"){
  amphibdir <- path.expand("c:/git/amphib_dermal_collation/")
}
# Sumathy's desktop
if(Sys.info()[4]=="DESKTOP-7UFGA86"){
  amphibdir <- path.expand("C:/Users/Sumathy/amphib_dermal_collation/")
}

# Emma's laptop
if(Sys.info()[4]=="LZ2626UECHELSVI"){
  amphibdir <- path.expand("C:/Users/echelsvi/OneDrive - Environmental Protection Agency (EPA)/Profile/Documents/amphib_dermal_collation/amphib_dermal_collation-master/")
}

# Variable names for data
amphibdir_data_in <- paste(amphibdir,'data_in/',sep='')
amphibdir_data_out <- paste(amphibdir,'data_out/',sep='')
amphibdir_graphics <- paste(amphibdir,'graphics/',sep='')
amphibdir_src <- paste(amphibdir,'src/',sep='')

```

***

**Data from Relevant Studies**
========================================================
### Van Meter et al. 2014 and Van Meter et al. 2015

Van Meter et al. 2014 performed exposures for 5 pesticide active ingredients (imidacloprid, pendimethalin, atrazine, fipronil, tridimefon) and 7 species (Southern leopard frog (*Lithobates sphenocephala*), Fowler's toad (*Anaxyrus fowleri*), gray treefrog (*Hyla versicolor*), Northern cricket frog (*Acris crepitans*), Eastern narrowmouth toad (*Gastrophryne carolinensis*), barking treefrog (*Hyla gratiosa*) and green treefrog (*Hyla cinerea*)). Whole body tissue concentrations were measured after an 8 hour exposure period to contaminated soil.

Van Meter et al. 2015 contrasted two pesticide exposure scenarios: direct exposure through aerial overspray and indirect exposure through soil.  These scenarios tested the same 5 pesticide active ingredients and two of the species (barking treefrog (*Hyla gratiosa*) and green treefrog (*Hyla cinerea*)).

For our purposes, the Van Meter et al. 2015 essentially adds the aerial overspray exposures to the Van Meter et al. 2014 data set. 


*Note: this file does include metabolites into the totals for the parents*
```{r eval = TRUE, echo = FALSE, include = FALSE}
##################
#the data sets
##################
# import data from Van Meter 2014 and 2015 papers.
# this file does include metabolites into the totals for the parents
vm2015_file <- paste(amphibdir_data_in,"vm2014_data.csv", sep="")
file.exists(vm2015_file)
vm2015 <- read.table(vm2015_file, header = TRUE, sep = ",")
```
**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE}
dim(vm2015)
colnames(vm2015)
summary(vm2015)
```


### Van Meter et al. 2016

Van Meter et al. 2016 considered bioconcentration of 5 current-use pesticides (imidacloprid, atrazine, triadimefon, fipronil, and pedimethalin) in American toads (*Bufo americanus*) across soil types. Toads were exposed to one of two soil types with significantly different organic matter content (14.1% = high organic matter, 3.1% = low organic matter). Whole body tissue concentrations were measured after an 8 hour exposure period to contaminated soil.  

*Note: this file does include metabolites into the total for the parents*
```{r eval = TRUE, echo = FALSE, include = FALSE}
# import data from Van Meter 2016
#this file does include metabolites into the totals for the parents
vm2016_file <- paste(amphibdir_data_in,"vm2016_data.csv", sep="")
file.exists(vm2016_file)
vm2016 <- read.table(vm2016_file, header = TRUE, sep = ",")
```
**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE}
dim(vm2016)
colnames(vm2016)
summary(vm2016)
```


### Glinski et al. 2018a (Dehydration)

Glinski et al. 2018a studied how amphibian hydration status influences uptake of pesticides through dermal exposure. Amphibians (Southern leopard frogs (*Lithobates sphenocephala*) and Fowler's toads (*Anaxyrus fowleri*)) were dehyrated for periods of 0, 2, 4, 6, 8, or 10 hours prior to exposure to pesticide-contaminated soils. Pesticides studied included atrazine, triadimefon, metolachlor, chlorothalonil, and imidacloprid. Soil and whole-body homogenates were measured after an 8 hour exposure period.

*Note: this file does not combine daughters with parents*  
*Note: this file has body burdens and soil concentrations as separate rows*
```{r eval = TRUE, echo = FALSE, include = FALSE}
# import data from Glinski 2016 dehydration study
# this file does not combine daughters with parents
# this file also has body burdens and soil concentrations as separate rows
dag2016_dehy_file <- paste(amphibdir_data_in,"dag2016_data_dehydration.csv", sep="")
file.exists(dag2016_dehy_file)
dag2016_dehy0 <- read.table(dag2016_dehy_file, header = TRUE, sep = ",")
```
**Data Set Dimensions, column Names, and Summary:**
```{r eval = TRUE, echo = FALSE}
dim(dag2016_dehy0)
colnames(dag2016_dehy0)
summary(dag2016_dehy0)
```


### Henson-Ramsey 2008  

Henson-Ramsey 2008 tested the biological impact of exposure to malathion for tiger salamanders (*Ambystoma tigrinum*). Tiger salamanders were exposed to contaminated soils with 50 ug/cm^2^ or 100 ug/cm^2^ malathion and through ingestion of an earthworm exposed to contaminated soils with 200 ug/cm^2^ malathion. Tissue concentrations were assessed for five treatment groups: unexposed, exposed to 50 ug/cm^2^ contaminated soil for 1 day, exposed to 50 ug/cm^2^ for 2 days, exposed to 50 ug/cm^2^ contaminated soil for 2 days and fed a contaminated worm on the first exposure day, and exposed to 100 ug/cm^2^ contaminated soil for 2 days and fed a contaminated worm on the first exposure day.

```{r eval = TRUE, echo = FALSE, include = FALSE}
# import data from Henson-Ramsey 2008
hr2008_file <- paste(amphibdir_data_in,"hr2008_data.csv", sep="")
file.exists(hr2008_file)
hr2008 <- read.table(hr2008_file, header = TRUE, sep = ",")
```
**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE}
dim(hr2008)
colnames(hr2008)
summary(hr2008)
```


### Glinski et al. 2018b (Metabolites)

Glinski et al. 2018b assessed the potential metabolic activation of pesticides (atrazine, triadimefon, fopronil) in amphibians.  This data set (1) contains *in vitro* and *in vivo* metabolic rate constants derived from toad (*Anaxyrus terrestris*) livers during experiments measuring the depletion of pesticides and the formation of their metabolites.

```{r eval = TRUE, echo = FALSE, include = FALSE}
# import data from Glinski 2017 metabolite study
dag2016_metabolite_file <- paste(amphibdir_data_in,"dag2016_data_metabolites.csv", sep="")
file.exists(dag2016_metabolite_file)
dag2016_metabolite0 <- read.table(dag2016_metabolite_file, header = TRUE, sep = ",")
```
#### Metabolites data set (1)
**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE}
dim(dag2016_metabolite0)
colnames(dag2016_metabolite0)
summary(dag2016_metabolite0)
```

The *in vitro* derived constants were assessed for their precitability by exposing Fowler's toads (*Anaxyrus fowleri*) to contaminated soils at maximum application rate for 2, 4, 12, and 48 hours. This data set (merged) contains the data from the Fowler's toad experiment along with the tissue concentrations from data set 1; this data set is used in subsequent steps.
```{r eval = TRUE, echo = FALSE, include = FALSE}
# import data from Glinski 2017 metabolite study
dag2016_metabolite_merge_file <- paste(amphibdir_data_in,"dag2016_data_metabolites_4merge.csv", sep="")
file.exists(dag2016_metabolite_merge_file)
dag2016_metabolite_merge <- read.table(dag2016_metabolite_merge_file, header = TRUE, sep = ",")
```
#### Metabolites data set (merged)
**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(dag2016_metabolite_merge)
colnames(dag2016_metabolite_merge_file)
summary(dag2016_metabolite_merge)
```


### Glinski et al. 2018c (Biomarkers)

Glinski et al. 2018c exposed Southern leopard frogs (*Lithobates sphenocephala*) to either the maximum or 1/10th maximum pesticide application rate to single, double, or triple pesticide mixtures of bifenthrin, metolachlor, and triadimefon to consider the typical co-application of pesticides during agricultural growing seasons. Tissue concentrations and metabolomic profiling of amphibian livers were studied after an 8 hour exposure period to pesticide-contaminated soil.
```{r eval = TRUE, echo = FALSE, include = FALSE}
# import data from Glinski 2018 biomarkers study
dag2018_biomarkers_file <- paste(amphibdir_data_in,"dag2018_data_biomarkers.csv", sep="")
file.exists(dag2018_biomarkers_file)
dag2018_mbiomarker0 <- read.table(dag2018_biomarkers_file, header = TRUE, sep = ",")
```
**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE}
dim(dag2018_mbiomarker0)
colnames(dag2018_mbiomarker0)
summary(dag2018_mbiomarker0)
```

### Van Meter et al. 2018 (Multiple Pesticides Study)

Van Meter et al. 2018 evaluated risks to amphibians after exposure to a single pesticide and pesticide mixtures. The five pesticides studied were three herbicides (atrazine, metolachlor, and 2,4-D), one insecticide (malathion), and one fungicide (propiconazole). Juvenile green frogs (*Lithobates clamitans*) were exposed to contaminated soils for 8 hours and metabolic analysis of amphibian livers was conducted to measure the effects.  

Two data sets were generated from this study, one containing data for exposure to herbicides (single and mixed) and the other containing data for exposure to mixed pesticide treatments (herbicides, insecticide, fungicide).
```{r eval = TRUE, echo = FALSE, include = FALSE}
# import data from Van Meter 2017 herbs
rvm2017_herbs_file <- paste(amphibdir_data_in,"vm2017_herbs.csv", sep="")
file.exists(rvm2017_herbs_file)
rvm2017_herbs0 <- read.table(rvm2017_herbs_file, header = TRUE, sep = ",")
```
#### **Herbicide Data Set**
**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE}
dim(rvm2017_herbs0)
colnames(rvm2017_herbs0)
summary(rvm2017_herbs0)
```
```{r eval = TRUE, echo = FALSE, include = FALSE}
# import data from Van Meter 2017 hif
rvm2017_hif_file <- paste(amphibdir_data_in,"vm2017_hif.csv", sep="")
file.exists(rvm2017_hif_file)
rvm2017_hif0 <- read.table(rvm2017_hif_file, header = TRUE, sep = ",")
```
#### **Mixed Pesticide Data Set**
**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE}
dim(rvm2017_hif0)
colnames(rvm2017_hif0)
summary(rvm2017_hif0)
```


The herbicide and mixed pesticide data sets were cleaned and joined into a merged data set (referred to as Van Meter et al. 2018 Multiple Pesticides Study in subsequent steps). The single and mixed-pesticide treatments that were retained in the merged data set included the chemicals atrazine, propiconazole, 2,4-D, malathion, and metolachlor.  Original columns from the herbicide and mixed pesticide data sets were altered for standardization. These standardized columns will be used in future data cleaning steps in order to merge all data sets. 
```{r eval = TRUE, echo = FALSE, include = FALSE}
rvm2017_merge_file <- paste(amphibdir_data_in,"vm2017_merge.csv", sep="")
file.exists(rvm2017_merge_file)
rvm2017_merge <- read.table(rvm2017_merge_file, header = TRUE, sep = ",")
```
#### **Merged Data Set**
**Data Set Dimensions, Column Names, and Summary:**
```{r eval = TRUE, echo = FALSE}
dim(rvm2017_merge)
colnames(rvm2017_merge)
summary(rvm2017_merge)
```


***

**Cleaning and Merging the Data Sets**
=============================================================
Each of the data sets were cleaned for merging. This consisted of dropping unneeded columns and standardizing column names of retained columns.  Four columns were added to all data sets (soil type, formulation, exposure duration, and research study source).  
Once each data set was cleaned, a local copy was saved and the data set was merged with the previously cleaned data sets.
```{r eval = TRUE, echo = FALSE, include = FALSE}
##################
#van meter 2014/15
##################
unique(vm2015$Chemical)
#drop metabolites and parents that do not include metabolites
vm2015_chem_drop <- c("Atrazine","Deisopropyl Atrazine","Desethyl Atrazine","Fipronil","Fipronil-Sulfone","Triadimefon","Triadimenol")
chem_vector_drop <- which(vm2015$Chemical %in% vm2015_chem_drop)
vm2015_subset1 <- vm2015[-chem_vector_drop,]
vm2015_subset2 <- droplevels(vm2015_subset1)
#drop unneeded columns for merging
#View(vm2015_subset2)
all_cols <- colnames(vm2015_subset2)
drop_cols <- c("Instrument", "good", "logKow", "BCF", "initialweight", 
            "Solat20C_mgL", "Solat20C_gL", "molmass_gmol", "Density_gcm3","AppFactor", "SA_cm2", "VapPrs_mPa",
            "Koc_gmL", "HalfLife_day", "HabFac")
vm2015_subset3 <- vm2015_subset2[,!(names(vm2015_subset2) %in% drop_cols)]
colnames(vm2015_subset3)
#add columns
soil_type <- c(rep("PLE",nrow(vm2015_subset3)))
formulation <- (rep(0,nrow(vm2015_subset3)))
exp_duration<- (rep(8,nrow(vm2015_subset3)))
source <- c(rep("rvm2015",nrow(vm2015_subset3)))
vm2015_subset4 <- cbind(vm2015_subset3, formulation, soil_type, exp_duration, source)
# standardize column names
colnames(vm2015_subset4)
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="Sample")]<-"sample_id"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="Species")]<-"species"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="Chemical")]<-"chemical"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="Application")]<-"application"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="TissueConc")]<-"tissue_conc_ugg"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="SoilConc")]<-"soil_conc_ugg"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="bodyweight")]<-"body_weight_g"
colnames(vm2015_subset4)
#reorder vm2015 alphabetically
vm2015_merge <- vm2015_subset4[,order(names(vm2015_subset4))]

#write a local copy
vm2015_merge_filename <- paste(amphibdir_data_out,"vm2015_merge.csv", sep="")
write.csv(vm2015_merge, file=vm2015_merge_filename)
```
**The column names of the cleaned data sets are as follows:**
```{r eval = TRUE, echo = FALSE, include = TRUE}
colnames(vm2015_merge)
```

The process of cleaning and merging each data set is briefly described below.

*** 

### Van Meter et al. 2014/2015
```{r eval = TRUE, echo = FALSE, include = FALSE}
#note: this code is a repeat of the above lines, used for displaying in R Markdown
unique(vm2015$Chemical)
#drop metabolites and parents that do not include metabolites
vm2015_chem_drop <- c("Atrazine","Deisopropyl Atrazine","Desethyl Atrazine","Fipronil","Fipronil-Sulfone","Triadimefon","Triadimenol")
chem_vector_drop <- which(vm2015$Chemical %in% vm2015_chem_drop)
vm2015_subset1 <- vm2015[-chem_vector_drop,]
vm2015_subset2 <- droplevels(vm2015_subset1)
```
Metabolites and parents that do not include metabolites were dropped from the data set. This includes atrazine, deisopropyl atrazine, desethyl atrazine, fipronil, fipronil-sulfone, triadimefon, triadimenol.    

There were `r length(chem_vector_drop)` observations with these chemicals.  After dropping the `r length(chem_vector_drop)` observations from the initial `r nrow(vm2015)`, the updated dimensions are:
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(vm2015_subset2)
```


```{r eval = TRUE, echo = FALSE, include = FALSE}
#drop unneeded columns for merging
all_cols <- colnames(vm2015_subset2)
drop_cols <- c("Instrument", "good", "logKow", "BCF", "initialweight", 
            "Solat20C_mgL", "Solat20C_gL", "molmass_gmol", "Density_gcm3","AppFactor", "SA_cm2",                        "VapPrs_mPa", "Koc_gmL", "HalfLife_day", "HabFac")
vm2015_subset3 <- vm2015_subset2[,!(names(vm2015_subset2) %in% drop_cols)]
colnames(vm2015_subset3)
#add columns
soil_type <- c(rep("PLE",nrow(vm2015_subset3)))
formulation <- (rep(0,nrow(vm2015_subset3)))
exp_duration<- (rep(8,nrow(vm2015_subset3)))
source <- c(rep("rvm2015",nrow(vm2015_subset3)))
vm2015_subset4 <- cbind(vm2015_subset3, formulation, soil_type, exp_duration, source)
# standardize column names
colnames(vm2015_subset4)
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="Sample")]<-"sample_id"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="Species")]<-"species"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="Chemical")]<-"chemical"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="Application")]<-"application"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="TissueConc")]<-"tissue_conc_ugg"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="SoilConc")]<-"soil_conc_ugg"
colnames(vm2015_subset4)[which(colnames(vm2015_subset4)=="bodyweight")]<-"body_weight_g"
colnames(vm2015_subset4)
```
There were `r length(drop_cols)` unneeded columns dropped and 4 added for standarization.  

**The combined data set's updated dimensions are:**
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(vm2015_merge)
```


### Van Meter et al. 2016
```{r eval = TRUE, echo = FALSE, include = FALSE}
##################
#van meter 2016
##################
#Reformat vm2016 for merge with vm2015
dim(vm2016)
colnames(vm2016)
#add sample_id
vm2016$sample_id <- paste(vm2016$Day, vm2016$Row, vm2016$Column, sep="_")
vm2016_subset2 <- subset(vm2016, select=c(-Day,-Row, -Column, -Total))
#add additional columns
species <- c(rep("American toad",nrow(vm2016_subset2)))
application <- c(rep("Indirect",nrow(vm2016_subset2)))
exp_duration<- (rep(8,nrow(vm2016_subset2)))
source <- c(rep("rvm2016",nrow(vm2016_subset2)))
vm2016_subset3 <- cbind(vm2016_subset2, species, application, exp_duration, source)
```
From the initial 11 columns, 4 columns were dropped and consolidated into 1, and 4 columns were added.
```{r eval = TRUE, echo = FALSE, include = FALSE}
#assign values to application rate
unique(vm2016_subset3$Pesticide)
colnames(vm2016_subset3)
vm2016_subset3$app_rate_g_cm2[vm2016_subset3$Pesticide=="ATZTOT"] <- 22.9e-6
vm2016_subset3$app_rate_g_cm2[vm2016_subset3$Pesticide=="Imid"] <- 5.7e-6
vm2016_subset3$app_rate_g_cm2[vm2016_subset3$Pesticide=="FipTOT"] <- 1.1e-6
vm2016_subset3$app_rate_g_cm2[vm2016_subset3$Pesticide=="TNDTOT"] <- 2.7e-6
vm2016_subset3$app_rate_g_cm2[vm2016_subset3$Pesticide=="Pendi"] <- 69.8e-6
colnames(vm2016_subset3)
#drop decay products that were not sprayed, keeping only parents
rows_to_drop <- which(vm2016_subset3$Parent == 0)
vm2016_subset4 <- vm2016_subset3[-rows_to_drop,]
#drop ATZ,Fip, TDN since does not include metabolites in total
chems_to_drop <- c("ATZ","Fip","TDN")
vm2016_subset5 <- vm2016_subset4[!(vm2016_subset4$Pesticide %in% chems_to_drop),]
#now drop parent field
drop_cols <- c("Parent")
vm2016_subset6 <- vm2016_subset5[,!(names(vm2016_subset5) %in% drop_cols)]
# standardize column names
#View(vm2016_subset4)
colnames(vm2016_subset6)
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="Pesticide")]<-"chemical"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="SoilType")]<-"soil_type"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="BodyBurden")]<-"tissue_conc_ugg"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="Soil")]<-"soil_conc_ugg"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="Weight")]<-"body_weight_g"
colnames(vm2016_subset6)[which(colnames(vm2016_subset6)=="Formulation")]<-"formulation"

# reorder columns alphabetically to help with merge
#reorder vm2016
colnames(vm2016_subset6)
vm2016_merge <- vm2016_subset6[,order(names(vm2016_subset6))]
dim(vm2016_merge)
colnames(vm2016_merge)
#write a local copy
vm2016_merge_filename <- paste(amphibdir_data_out,"vm2016_merge.csv", sep="")
write.csv(vm2016_merge, file=vm2016_merge_filename)
```
There were `r length(rows_to_drop)` observations with decay products that were not sprayed; these observations were dropped so as to only include the parents in the cleaned data set.        

There were `r length(which(vm2016_subset4$Pesticide %in% chems_to_drop))` observations with atrazine, fipronil, or triadimefon that were dropped because they do not include metabolites in total.  From the initial `r nrow(vm2016)` rows, the updated dimensions are:
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(vm2016_merge)
```


The Van Meter et al. 2014/2015 and Van Meter et al. 2016 data sets were combined.  

```{r eval=TRUE, echo=FALSE, include = FALSE}
colnames(vm2015_merge)
colnames(vm2016_merge)
dim(vm2015_merge)
dim(vm2016_merge)
# combine two dataframes
combined_data0 <- rbind(vm2015_merge, vm2016_merge)
dim(combined_data0)
colnames(combined_data0)
#View(combined_data0)
combined_data_filename0 <- paste(amphibdir_data_out,"combined_data0.csv", sep="")
write.csv(combined_data0, file=combined_data_filename0)
```
**The combined data set's updated dimensions are:**
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(combined_data0)
```


### Glinski et al. 2018a (Dehydration)

```{r eval=TRUE, echo=FALSE, include = FALSE}
##################
#glinski et al 2017 dehydration
##################
#Revise dag2016_dehy to merge with van meter data sets
dim(dag2016_dehy0)
colnames(dag2016_dehy0)
#from
#[1] "time"    "parent"  "analyte" "matrix"  "species" "conc"    "ID"      "weight"

#to
# [1] "chemical"        "soil_type"       "tissue_conc_ugg" "soil_conc_ugg"   "body_weight_g"  
# [6] "formulation"     "species"         "application"     "exp_duration"    "app_rate_g_cm2"

# drop metabolite products
parent_keepers <- which(as.vector(dag2016_dehy0$parent) == as.vector(dag2016_dehy0$analyte))
dag2016_dehy1 <- dag2016_dehy0[parent_keepers,]
#View(dag2016_dehy0)
```
The metabolite products were dropped from the data set; `r length(parent_keepers)` rows from the initial `r nrow(dag2016_dehy0)` rows were retained.


```{r eval = TRUE, echo = FALSE, include = FALSE}
## time is length of dehydration
#colnames(dag2016_dehy1)[which(colnames(dag2016_dehy1)=="time")]<-"exp_duration"
# analyte change to chemical
colnames(dag2016_dehy1)[which(colnames(dag2016_dehy1)=="analyte")]<-"chemical"
# conc to tissue concs
colnames(dag2016_dehy1)[which(colnames(dag2016_dehy1)=="conc")]<-"tissue_conc_ugg"
# species same
# change ID to sample_id
colnames(dag2016_dehy1)[which(colnames(dag2016_dehy1)=="ID")]<-"sample_id"
# weight change to body_weight_g
colnames(dag2016_dehy1)[which(colnames(dag2016_dehy1)=="weight")]<-"body_weight_g"
# add soil_type (PLE, OLS), formulation (0,1), application (Overspray, Indirect) and app_rate_g_cm2 fields
exp_duration <- c(rep(8,nrow(dag2016_dehy1)))
soil_type <- c(rep("PLE",nrow(dag2016_dehy1)))
application <- c(rep("Indirect",nrow(dag2016_dehy1)))
formulation <- (rep(0,nrow(dag2016_dehy1)))
app_rate_g_cm2 <- (rep(0,nrow(dag2016_dehy1)))
soil_conc_ugg <- (rep(0,nrow(dag2016_dehy1)))
source <- c(rep("dag_dehydration",nrow(dag2016_dehy1)))
dag2016_dehy2 <- cbind(dag2016_dehy1, formulation, soil_type, application, 
                       app_rate_g_cm2, exp_duration, soil_conc_ugg, source)
```
Several column names were altered for standarization across the data sets, and 7 columns were added (exposure duration, soil type, application, application rate, formulation, soil concentration, research study source).  The updated dimensions are:
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(dag2016_dehy2)
```


```{r eval = TRUE, echo = FALSE, include = FALSE}

#reshape- cast takes long-format data and casts it into wide-format data
# matrix used to split to soil and amphibian conc columns and delete
# conc split to soil and amphibian conc columns
#make wide with soil and amphib concentrations

colnames(dag2016_dehy2)

#multiple soil concentration observations per id
#dag2016_dehy_mergefail <- dcast(dag2016_dehy3, 
#                       tissue_conc_ugg + sample_id + species + chemical + exp_duration ~ matrix, 
#                       value.var = c("tissue_conc_ugg"))
#View(dag2016_mergefail)

#drop the soil until we can do a many-to-one merge of soil concentrations
#drop decay products that were not sprayed, keeping only parents
rows_to_drop <- which(dag2016_dehy2$matrix == 'soil')
dag2016_dehy3 <- dag2016_dehy2[-rows_to_drop,]
# parent, time and matrix columns delete
drop_cols <- c("parent","time","matrix")
dag2016_dehy4 <- dag2016_dehy3[,!(names(dag2016_dehy3) %in% drop_cols)]
```

Multiple soil concentration observations were given the same ID. Until a many-to-one merge of soil concentrations could be executed, `r length(rows_to_drop)` rows were temporarily dropped.  There were also `r length(drop_cols)` columns dropped.  The updated dimensions are:
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(dag2016_dehy4)
```


```{r eval = TRUE, echo = FALSE, include = FALSE}
unique(dag2016_dehy4$chemical)
update_atrazine <- which(dag2016_dehy4$chemical == 'atrazine')
dag2016_dehy4$app_rate_g_cm2[update_atrazine] <- 0.00002395 # atrazine g/cm2
update_chloro <- which(dag2016_dehy4$chemical == 'chloro+d')
dag2016_dehy4$app_rate_g_cm2[update_chloro] <-  0.0000443 # chloro g/cm2
update_metol <- which(dag2016_dehy4$chemical == 'metol')
dag2016_dehy4$app_rate_g_cm2[update_metol] <-  0.00003101 # metol g/cm2
update_tdn <- which(dag2016_dehy4$chemical == 'tdn')
dag2016_dehy4$app_rate_g_cm2[update_tdn] <- 0.00000291 # tdn g/cm2
update_imid <- which(dag2016_dehy4$chemical == 'imid')
dag2016_dehy4$app_rate_g_cm2[update_imid] <- 0.00000539 # imid g/cm2
dim(dag2016_dehy4)

# add back in soil concentrations
dag2016_soil <- dag2016_dehy2[rows_to_drop,]
colnames(dag2016_soil)
dag2016_soil$tissue_conc_ugg

dag2016_dehy4$soil_conc_ugg <- dag2016_soil$tissue_conc_ugg
#View(cbind(as.vector(dag2016_dehy4$sample_id),as.vector(dag2016_dehy4$sample_id)))
#View(cbind(dag2016_dehy4$tissue_conc_ugg,dag2016_dehy4$soil_conc_ugg))
bcf <- dag2016_dehy4$tissue_conc_ugg/dag2016_dehy4$soil_conc_ugg
min(bcf)
max(bcf)
# reorder columns alphabetically to help with merge
#reorder dag2016_dehy4
colnames(dag2016_dehy4)
dag2016_dehy_merge <- dag2016_dehy4[,order(names(dag2016_dehy4))]
dim(dag2016_dehy_merge)
colnames(dag2016_dehy_merge)
#write a local copy
dag2016_dehy_merge_filename <- paste(amphibdir_data_out,"dag2016_dehy_merge.csv", sep="")
write.csv(dag2016_dehy_merge, dag2016_dehy_merge_filename)

```
The application rate values (app_rate_g_cm2) were updated for the pesticides, and the temporarily dropped soil concentrations were updated to the current data set.  The dimensions are still:
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(dag2016_dehy_merge)
```


The Glinkski et al. 2018a (Dehydration) was combined with the previously merged data sets.
```{r eval=TRUE, echo=FALSE, include = FALSE}
#View(dag2016_dehy_merge)
colnames(combined_data0)
colnames(dag2016_dehy_merge)
dim(combined_data0)
dim(dag2016_dehy_merge)
# combine two dataframes
combined_data1 <- rbind(combined_data0, dag2016_dehy_merge)
dim(combined_data1)
colnames(combined_data1)
rownames(combined_data1) <- seq(length=nrow(combined_data1))
#View(combined_data1)
combined_data_filename1 <- paste(amphibdir_data_out,"combined_data1.csv", sep="")
write.csv(combined_data1, file=combined_data_filename1)
```
**The combined data set's updated dimensions are:**
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(combined_data1)
```


### Henson-Ramsey 2008

The Henson-Ramsey 2008 data set did not require any additional data cleaning. It was combined with the previously merged data sets.
```{r eval=TRUE, echo=FALSE, include = FALSE}
colnames(combined_data1)
colnames(hr2008)
dim(combined_data1)
dim(hr2008)
# combine two dataframes
combined_data2 <- rbind(combined_data1, hr2008)
dim(combined_data2)
colnames(combined_data2)
rownames(combined_data2) <- seq(length=nrow(combined_data2))
colnames(combined_data2)
#View(combined_data2)
combined_data_filename2 <- paste(amphibdir_data_out,"combined_data2.csv", sep="")
write.csv(combined_data2, file=combined_data_filename2)
```
**The combined data set's updated dimensions are:**
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(combined_data2)
```


### Glinski et al. 2018b (Metabolites)

The Glinski et al. 2018b (Metabolites) data set did not require any additional data cleaning. It was combined with the previously merged data sets.
```{r eval=TRUE, echo=FALSE, include = FALSE}
##################
#glinski et al 2017 metabolites
##################
dim(dag2016_metabolite_merge)
colnames(dag2016_metabolite_merge)
#View(dag2016_metabolite_merge)
# combine two dataframes
combined_data3 <- rbind(combined_data2, dag2016_metabolite_merge)
dim(combined_data3)
colnames(combined_data3)
rownames(combined_data3) <- seq(length=nrow(combined_data3))
colnames(combined_data3)
#View(combined_data3)
combined_data_filename3 <- paste(amphibdir_data_out,"combined_data3.csv", sep="")
write.csv(combined_data3, file=combined_data_filename3)
```
**The combined data set's updated dimensions are:**
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(combined_data3)
```


### Van Meter et al. 2018 (Multiple Pesticides Study)

The Van Meter et al. 2018 (Multiple Pesticides Study) data set did not require any additional data cleaning. It was combined with the previously merged data sets.
```{r eval=TRUE, echo=FALSE, include = FALSE}
##################
#van meter et al 2017 multi-pesticide study merge
##################
dim(rvm2017_merge)
colnames(rvm2017_merge)
#View(rvm2017_merge)
# combine two dataframes
combined_data4 <- rbind(combined_data3, rvm2017_merge)
dim(combined_data4)
colnames(combined_data4)
rownames(combined_data4) <- seq(length=nrow(combined_data4))
colnames(combined_data4)
#View(combined_data4)
combined_data_filename4 <- paste(amphibdir_data_out,"combined_data4.csv", sep="")
write.csv(combined_data4, file=combined_data_filename4)
```
**The combined data set's updated dimensions are:**
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(combined_data4)
```


***

**Final Product**
=============================================================
The combined data set was examined to ensure validity. Minor alterations were made with factor levels.
```{r eval=TRUE, echo=FALSE, include = FALSE}
##################
#write out the entire final product
##################
amphib_dermal_collated <- combined_data4
#View(amphib_dermal_collated)
colnames(amphib_dermal_collated)
#check to see if everything ok
summary(amphib_dermal_collated$app_rate_g_cm2) # units issues
summary(amphib_dermal_collated$body_weight_g) # 60 NAs
summary(amphib_dermal_collated$exp_duration)
summary(amphib_dermal_collated$soil_conc_ugg) # 206 NAs
summary(amphib_dermal_collated$tissue_conc_ugg)

#change application to correct categories
amphib_dermal_collated$application <- tolower(amphib_dermal_collated$application)
amphib_dermal_collated$application <- as.factor(amphib_dermal_collated$application)

amphib_dermal_collated_filename <- paste(amphibdir_data_out,"amphib_dermal_collated.csv", sep="")
write.csv(amphib_dermal_collated, file=amphib_dermal_collated_filename)
```
**Column Names**
```{r eval = TRUE, echo = FALSE, include = TRUE}
colnames(amphib_dermal_collated)
```

**Dimensions**
```{r eval = TRUE, echo = FALSE, include = TRUE}
dim(amphib_dermal_collated)
```

**Variable Summaries**  
*Note: there are 206 NAs for soil_conc_ugg and for soil_type*
```{r eval = TRUE, echo = FALSE, include = TRUE}
summary(amphib_dermal_collated)
```

**Data Set Head, for view**
```{r eval = TRUE, echo = FALSE, include = TRUE}
head(amphib_dermal_collated, n = 4)
```
